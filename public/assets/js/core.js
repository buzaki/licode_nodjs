if(function(a,b){a.version="0.9.6",a.protocol=1,a.transports=[],a.j=[],a.sockets={},a.connect=function(c,d){var f,g,e=a.util.parseUri(c);b&&b.location&&(e.protocol=e.protocol||b.location.protocol.slice(0,-1),e.host=e.host||(b.document?b.document.domain:b.location.hostname),e.port=e.port||b.location.port),f=a.util.uniqueUri(e);var h={host:e.host,secure:"https"==e.protocol,port:e.port||("https"==e.protocol?443:80),query:e.query||""};return a.util.merge(h,d),!h["force new connection"]&&a.sockets[f]||(g=new a.Socket(h)),!h["force new connection"]&&g&&(a.sockets[f]=g),g=g||a.sockets[f],g.of(1<e.path.length?e.path:"")}}("object"==typeof module?module.exports:this.io={},this),function(a,b){var c=a.util={},d=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e="source,protocol,authority,userInfo,user,password,host,port,relative,path,directory,file,query,anchor".split(",");c.parseUri=function(a){for(var a=d.exec(a||""),b={},c=14;c--;)b[e[c]]=a[c]||"";return b},c.uniqueUri=function(a){var c=a.protocol,d=a.host,a=a.port;return"document"in b?(d=d||document.domain,a=a||("https"==c&&"https:"!==document.location.protocol?443:document.location.port)):(d=d||"localhost",!a&&"https"==c&&(a=443)),(c||"http")+"://"+d+":"+(a||80)},c.query=function(a,b){var d=c.chunkQuery(a||""),e=[];c.merge(d,c.chunkQuery(b||""));for(var f in d)d.hasOwnProperty(f)&&e.push(f+"="+d[f]);return e.length?"?"+e.join("&"):""},c.chunkQuery=function(a){for(var e,b={},a=a.split("&"),c=0,d=a.length;c<d;++c)e=a[c].split("="),e[0]&&(b[e[0]]=e[1]);return b};var f=!1;c.load=function(a){return"document"in b&&"complete"===document.readyState||f?a():void c.on(b,"load",a,!1)},c.on=function(a,b,c,d){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,d)},c.request=function(a){if(a&&"undefined"!=typeof XDomainRequest)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||c.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(a){}return null},"undefined"!=typeof window&&c.load(function(){f=!0}),c.defer=function(a){return c.ua.webkit&&"undefined"==typeof importScripts?void c.load(function(){setTimeout(a,100)}):a()},c.merge=function(a,b,d,e){var f,e=e||[],d="undefined"==typeof d?2:d;for(f in b)b.hasOwnProperty(f)&&0>c.indexOf(e,f)&&("object"==typeof a[f]&&d?c.merge(a[f],b[f],d-1,e):(a[f]=b[f],e.push(b[f])));return a},c.mixin=function(a,b){c.merge(a.prototype,b.prototype)},c.inherit=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c},c.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},c.intersect=function(a,b){for(var d=[],e=a.length>b.length?a:b,f=a.length>b.length?b:a,g=0,h=f.length;g<h;g++)~c.indexOf(e,f[g])&&d.push(f[g]);return d},c.indexOf=function(a,b,c){for(var d=a.length,c=0>c?0>c+d?0:c+d:c||0;c<d&&a[c]!==b;c++);return d<=c?-1:c},c.toArray=function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c]);return b},c.ua={},c.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(a){return!1}return void 0!=a.withCredentials}(),c.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent)}("undefined"!=typeof io?io:module.exports,this),function(a,b){function c(){}a.EventEmitter=c,c.prototype.on=function(a,c){return this.$events||(this.$events={}),this.$events[a]?b.util.isArray(this.$events[a])?this.$events[a].push(c):this.$events[a]=[this.$events[a],c]:this.$events[a]=c,this},c.prototype.addListener=c.prototype.on,c.prototype.once=function(a,b){function c(){d.removeListener(a,c),b.apply(this,arguments)}var d=this;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,c){if(this.$events&&this.$events[a]){var d=this.$events[a];if(b.util.isArray(d)){for(var e=-1,f=0,g=d.length;f<g;f++)if(d[f]===c||d[f].listener&&d[f].listener===c){e=f;break}if(0>e)return this;d.splice(e,1),d.length||delete this.$events[a]}else(d===c||d.listener&&d.listener===c)&&delete this.$events[a]}return this},c.prototype.removeAllListeners=function(a){return this.$events&&this.$events[a]&&(this.$events[a]=null),this},c.prototype.listeners=function(a){return this.$events||(this.$events={}),this.$events[a]||(this.$events[a]=[]),b.util.isArray(this.$events[a])||(this.$events[a]=[this.$events[a]]),this.$events[a]},c.prototype.emit=function(a){if(!this.$events)return!1;var c=this.$events[a];if(!c)return!1;var d=Array.prototype.slice.call(arguments,1);if("function"==typeof c)c.apply(this,d);else{if(!b.util.isArray(c))return!1;for(var c=c.slice(),e=0,f=c.length;e<f;e++)c[e].apply(this,d)}return!0}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(b,a){function c(a){return 10>a?"0"+a:a}function f(a){return j.lastIndex=0,j.test(a)?'"'+a.replace(j,function(a){var b=g[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function e(a,b){var g,h,i,j,n,l=d,o=b[a];switch(o instanceof Date&&(o=isFinite(a.valueOf())?a.getUTCFullYear()+"-"+c(a.getUTCMonth()+1)+"-"+c(a.getUTCDate())+"T"+c(a.getUTCHours())+":"+c(a.getUTCMinutes())+":"+c(a.getUTCSeconds())+"Z":null),"function"==typeof m&&(o=m.call(b,a,o)),typeof o){case"string":return f(o);case"number":return isFinite(o)?""+o:"null";case"boolean":case"null":return""+o;case"object":if(!o)return"null";if(d+=k,n=[],"[object Array]"===Object.prototype.toString.apply(o)){for(j=o.length,g=0;g<j;g+=1)n[g]=e(g,o)||"null";return i=0===n.length?"[]":d?"[\n"+d+n.join(",\n"+d)+"\n"+l+"]":"["+n.join(",")+"]",d=l,i}if(m&&"object"==typeof m)for(j=m.length,g=0;g<j;g+=1)"string"==typeof m[g]&&(h=m[g],(i=e(h,o))&&n.push(f(h)+(d?": ":":")+i));else for(h in o)Object.prototype.hasOwnProperty.call(o,h)&&(i=e(h,o))&&n.push(f(h)+(d?": ":":")+i);return i=0===n.length?"{}":d?"{\n"+d+n.join(",\n"+d)+"\n"+l+"}":"{"+n.join(",")+"}",d=l,i}}if(a&&a.parse)return b.JSON={parse:a.parse,stringify:a.stringify};var i=b.JSON={},h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,k,g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;i.stringify=function(a,b,c){var f;if(k=d="","number"==typeof c)for(f=0;f<c;f+=1)k+=" ";else"string"==typeof c&&(k=c);if((m=b)&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw Error("JSON.stringify");return e("",{"":a})},i.parse=function(a,d){function b(a,c){var e,f,g=a[c];if(g&&"object"==typeof g)for(e in g)Object.prototype.hasOwnProperty.call(g,e)&&(f=b(g,e),void 0!==f?g[e]=f:delete g[e]);return d.call(a,c,g)}var e,a=""+a;if(h.lastIndex=0,h.test(a)&&(a=a.replace(h,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return e=eval("("+a+")"),"function"==typeof d?b({"":e},""):e;throw new SyntaxError("JSON.parse")}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof JSON?JSON:void 0),function(a,b){var c=a.parser={},d=c.packets="disconnect,connect,heartbeat,message,json,event,ack,error,noop".split(","),e=c.reasons=["transport not supported","client not handshaken","unauthorized"],f=c.advice=["reconnect"],g=b.JSON,h=b.util.indexOf;c.encodePacket=function(a){var b=h(d,a.type),c=a.id||"",i=a.endpoint||"",j=a.ack,k=null;switch(a.type){case"error":var l=a.reason?h(e,a.reason):"",a=a.advice?h(f,a.advice):"";""===l&&""===a||(k=l+(""!==a?"+"+a:""));break;case"message":""!==a.data&&(k=a.data);break;case"event":k={name:a.name},a.args&&a.args.length&&(k.args=a.args),k=g.stringify(k);break;case"json":k=g.stringify(a.data);break;case"connect":a.qs&&(k=a.qs);break;case"ack":k=a.ackId+(a.args&&a.args.length?"+"+g.stringify(a.args):"")}return b=[b,c+("data"==j?"+":""),i],null!==k&&void 0!==k&&b.push(k),b.join(":")},c.encodePayload=function(a){var b="";if(1==a.length)return a[0];for(var c=0,d=a.length;c<d;c++)b+="�"+a[c].length+"�"+a[c];return b};var i=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;c.decodePacket=function(a){var b=a.match(i);if(!b)return{};var c=b[2]||"",a=b[5]||"",h={type:d[b[1]],endpoint:b[4]||""};switch(c&&(h.id=c,h.ack=!b[3]||"data"),h.type){case"error":b=a.split("+"),h.reason=e[b[0]]||"",h.advice=f[b[1]]||"";break;case"message":h.data=a||"";break;case"event":try{var j=g.parse(a);h.name=j.name,h.args=j.args}catch(a){}h.args=h.args||[];break;case"json":try{h.data=g.parse(a)}catch(a){}break;case"connect":h.qs=a||"";break;case"ack":if((b=a.match(/^([0-9]+)(\+)?(.*)/))&&(h.ackId=b[1],h.args=[],b[3]))try{h.args=b[3]?g.parse(b[3]):[]}catch(a){}}return h},c.decodePayload=function(a){if("�"==a.charAt(0)){for(var b=[],d=1,e="";d<a.length;d++)"�"==a.charAt(d)?(b.push(c.decodePacket(a.substr(d+1).substr(0,e))),d+=Number(e)+1,e=""):e+=a.charAt(d);return b}return[c.decodePacket(a)]}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b){function c(a,b){this.socket=a,this.sessid=b}a.Transport=c,b.util.mixin(c,b.EventEmitter),c.prototype.onData=function(a){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==a&&(a=b.parser.decodePayload(a))&&a.length)for(var c=0,d=a.length;c<d;c++)this.onPacket(a[c]);return this},c.prototype.onPacket=function(a){return this.socket.setHeartbeatTimeout(),"heartbeat"==a.type?this.onHeartbeat():("connect"==a.type&&""==a.endpoint&&this.onConnect(),"error"==a.type&&"reconnect"==a.advice&&(this.open=!1),this.socket.onPacket(a),this)},c.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}},c.prototype.onDisconnect=function(){return this.close&&this.open&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},c.prototype.onConnect=function(){return this.socket.onConnect(),this},c.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},c.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},c.prototype.packet=function(a){this.send(b.parser.encodePacket(a))},c.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},c.prototype.onOpen=function(){this.open=!0,this.clearCloseTimeout(),this.socket.onOpen()},c.prototype.onClose=function(){this.open=!1,this.socket.onClose(),this.onDisconnect()},c.prototype.prepareUrl=function(){var a=this.socket.options;return this.scheme()+"://"+a.host+":"+a.port+"/"+a.resource+"/"+b.protocol+"/"+this.name+"/"+this.sessid},c.prototype.ready=function(a,b){b.call(this)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(a){if(this.options={port:80,secure:!1,document:"document"in c&&document,resource:"socket.io",transports:b.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!0,"auto connect":!0,"flash policy port":10843},b.util.merge(this.options,a),this.reconnecting=this.connecting=this.open=this.connected=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||b.util.ua.hasCORS)){var d=this;b.util.on(c,"unload",function(){d.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function e(){}a.Socket=d,b.util.mixin(d,b.EventEmitter),d.prototype.of=function(a){return this.namespaces[a]||(this.namespaces[a]=new b.SocketNamespace(this,a),""!==a&&this.namespaces[a].packet({type:"connect"})),this.namespaces[a]},d.prototype.publish=function(){this.emit.apply(this,arguments);var a,b;for(b in this.namespaces)this.namespaces.hasOwnProperty(b)&&(a=this.of(b),a.$emit.apply(a,arguments))},d.prototype.handshake=function(a){function c(b){b instanceof Error?d.onError(b.message):a.apply(null,b.split(":"))}var d=this,f=this.options,f=["http"+(f.secure?"s":"")+":/",f.host+":"+f.port,f.resource,b.protocol,b.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!b.util.ua.hasCORS){var g=document.getElementsByTagName("script")[0],h=document.createElement("script");h.src=f+"&jsonp="+b.j.length,g.parentNode.insertBefore(h,g),b.j.push(function(a){c(a),h.parentNode.removeChild(h)})}else{var i=b.util.request();i.open("GET",f,!0),i.withCredentials=!0,i.onreadystatechange=function(){4==i.readyState&&(i.onreadystatechange=e,200==i.status?c(i.responseText):!d.reconnecting&&d.onError(i.responseText))},i.send(null)}},d.prototype.getTransport=function(a){for(var d,a=a||this.transports,c=0;d=a[c];c++)if(b.Transport[d]&&b.Transport[d].check(this)&&(!this.isXDomain()||b.Transport[d].xdomainCheck()))return new b.Transport[d](this,this.sessionid);return null},d.prototype.connect=function(a){if(this.connecting)return this;var c=this;return this.handshake(function(d,e,f,g){function h(a){return c.transport&&c.transport.clearTimeouts(),c.transport=c.getTransport(a),c.transport?void c.transport.ready(c,function(){c.connecting=!0,c.publish("connecting",c.transport.name),c.transport.open(),c.options["connect timeout"]&&(c.connectTimeoutTimer=setTimeout(function(){if(!c.connected&&(c.connecting=!1,c.options["try multiple transports"])){c.remainingTransports||(c.remainingTransports=c.transports.slice(0));for(var a=c.remainingTransports;0<a.length&&a.splice(0,1)[0]!=c.transport.name;);a.length?h(a):c.publish("connect_failed")}},c.options["connect timeout"]))}):c.publish("connect_failed")}c.sessionid=d,c.closeTimeout=1e3*f,c.heartbeatTimeout=1e3*e,c.transports=g?b.util.intersect(g.split(","),c.options.transports):c.options.transports,c.setHeartbeatTimeout(),h(c.transports),c.once("connect",function(){clearTimeout(c.connectTimeoutTimer),a&&"function"==typeof a&&a()})}),this},d.prototype.setHeartbeatTimeout=function(){clearTimeout(this.heartbeatTimeoutTimer);var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)},d.prototype.packet=function(a){return this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a),this},d.prototype.setBuffer=function(a){this.doBuffer=a,!a&&this.connected&&this.buffer.length&&(this.transport.payload(this.buffer),this.buffer=[])},d.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},d.prototype.disconnectSync=function(){b.util.request().open("GET",this.resource+"/"+b.protocol+"/"+this.sessionid,!0),this.onDisconnect("booted")},d.prototype.isXDomain=function(){var a=c.location.port||("https:"==c.location.protocol?443:80);return this.options.host!==c.location.hostname||this.options.port!=a},d.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},d.prototype.onOpen=function(){this.open=!0},d.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},d.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)},d.prototype.onError=function(a){a&&a.advice&&"reconnect"===a.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",a&&a.reason?a.reason:a)},d.prototype.onDisconnect=function(a){var b=this.connected,c=this.connecting;this.open=this.connecting=this.connected=!1,(b||c)&&(this.transport.close(),this.transport.clearTimeouts(),b&&(this.publish("disconnect",a),"booted"!=a&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},d.prototype.reconnect=function(){function a(){if(c.connected){for(var a in c.namespaces)c.namespaces.hasOwnProperty(a)&&""!==a&&c.namespaces[a].packet({type:"connect"});c.publish("reconnect",c.transport.name,c.reconnectionAttempts)}clearTimeout(c.reconnectionTimer),c.removeListener("connect_failed",b),c.removeListener("connect",b),c.reconnecting=!1,delete c.reconnectionAttempts,delete c.reconnectionDelay,delete c.reconnectionTimer,delete c.redoTransports,c.options["try multiple transports"]=e}function b(){if(c.reconnecting){if(c.connected)return a();if(c.connecting&&c.reconnecting)return c.reconnectionTimer=setTimeout(b,1e3);c.reconnectionAttempts++>=d?c.redoTransports?(c.publish("reconnect_failed"),a()):(c.on("connect_failed",b),c.options["try multiple transports"]=!0,c.transport=c.getTransport(),c.redoTransports=!0,c.connect()):(c.reconnectionDelay<f&&(c.reconnectionDelay*=2),c.connect(),c.publish("reconnecting",c.reconnectionDelay,c.reconnectionAttempts),c.reconnectionTimer=setTimeout(b,c.reconnectionDelay))}}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var c=this,d=this.options["max reconnection attempts"],e=this.options["try multiple transports"],f=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(b,this.reconnectionDelay),this.on("connect",b)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(a,b){this.socket=a,this.name=b||"",this.flags={},this.json=new d(this,"json"),this.ackPackets=0,this.acks={}}function d(a,b){this.namespace=a,this.name=b}a.SocketNamespace=c,b.util.mixin(c,b.EventEmitter),c.prototype.$emit=b.EventEmitter.prototype.emit,c.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},c.prototype.packet=function(a){return a.endpoint=this.name,this.socket.packet(a),this.flags={},this},c.prototype.send=function(a,b){var c={type:this.flags.json?"json":"message",data:a};return"function"==typeof b&&(c.id=++this.ackPackets,c.ack=!0,this.acks[c.id]=b),this.packet(c)},c.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d={type:"event",name:a};return"function"==typeof c&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=c,b=b.slice(0,b.length-1)),d.args=b,this.packet(d)},c.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},c.prototype.onPacket=function(a){function c(){d.packet({type:"ack",args:b.util.toArray(arguments),ackId:a.id})}var d=this;switch(a.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(a.reason||"booted"):this.$emit("disconnect",a.reason);break;case"message":case"json":var e=["message",a.data];"data"==a.ack?e.push(c):a.ack&&this.packet({type:"ack",ackId:a.id}),this.$emit.apply(this,e);break;case"event":e=[a.name].concat(a.args),"data"==a.ack&&e.push(c),this.$emit.apply(this,e);break;case"ack":this.acks[a.ackId]&&(this.acks[a.ackId].apply(this,a.args),delete this.acks[a.ackId]);break;case"error":a.advice?this.socket.onError(a):"unauthorized"==a.reason?this.$emit("connect_failed",a.reason):this.$emit("error",a.reason)}},d.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},d.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}("undefined"!=typeof io?io:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(a){b.Transport.apply(this,arguments)}a.websocket=d,b.util.inherit(d,b.Transport),d.prototype.name="websocket",d.prototype.open=function(){var e,a=b.util.query(this.socket.options.query),d=this;return e||(e=c.MozWebSocket||c.WebSocket),this.websocket=new e(this.prepareUrl()+a),this.websocket.onopen=function(){d.onOpen(),d.socket.setBuffer(!1)},this.websocket.onmessage=function(a){d.onData(a.data)},this.websocket.onclose=function(){d.onClose(),d.socket.setBuffer(!0)},this.websocket.onerror=function(a){d.onError(a)},this},d.prototype.send=function(a){return this.websocket.send(a),this},d.prototype.payload=function(a){for(var b=0,c=a.length;b<c;b++)this.packet(a[b]);return this},d.prototype.close=function(){return this.websocket.close(),this},d.prototype.onError=function(a){this.socket.onError(a)},d.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},d.check=function(){return"WebSocket"in c&&!("__addTask"in WebSocket)||"MozWebSocket"in c},d.xdomainCheck=function(){return!0},b.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(){b.Transport.websocket.apply(this,arguments)}a.flashsocket=c,b.util.inherit(c,b.Transport.websocket),c.prototype.name="flashsocket",c.prototype.open=function(){var a=this,c=arguments;return WebSocket.__addTask(function(){b.Transport.websocket.prototype.open.apply(a,c)}),this},c.prototype.send=function(){var a=this,c=arguments;return WebSocket.__addTask(function(){b.Transport.websocket.prototype.send.apply(a,c)}),this},c.prototype.close=function(){return WebSocket.__tasks.length=0,b.Transport.websocket.prototype.close.call(this),this},c.prototype.ready=function(a,d){function e(){var b=a.options,e=b["flash policy port"],g=["http"+(b.secure?"s":"")+":/",b.host+":"+b.port,b.resource,"static/flashsocket","WebSocketMain"+(a.isXDomain()?"Insecure":"")+".swf"];c.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=g.join("/")),843!==e&&WebSocket.loadFlashPolicyFile("xmlsocket://"+b.host+":"+e),WebSocket.__initialize(),c.loaded=!0),d.call(f)}var f=this;return document.body?e():void b.util.load(e)},c.check=function(){return!!("undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject)&&10<=swfobject.getFlashPlayerVersion().major},c.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),b.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),"undefined"!=typeof window)var swfobject=function(){function a(){if(!I){try{var a=x.getElementsByTagName("body")[0].appendChild(x.createElement("span"));a.parentNode.removeChild(a)}catch(a){return}I=!0;for(var a=A.length,b=0;b<a;b++)A[b]()}}function b(a){I?a():A[A.length]=a}function c(a){if(typeof w.addEventListener!=s)w.addEventListener("load",a,!1);else if(typeof x.addEventListener!=s)x.addEventListener("load",a,!1);else if(typeof w.attachEvent!=s)n(w,"onload",a);else if("function"==typeof w.onload){var b=w.onload;w.onload=function(){b(),a()}}else w.onload=a}function d(){var a=x.getElementsByTagName("body")[0],b=x.createElement(t);b.setAttribute("type",u);var c=a.appendChild(b);if(c){var d=0;!function(){if(typeof c.GetVariable!=s){var f=c.GetVariable("$version");f&&(f=f.split(" ")[1].split(","),N.pv=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)])}else if(10>d)return d++,void setTimeout(arguments.callee,10);a.removeChild(b),c=null,e()}()}else e()}function e(){var a=B.length;if(0<a)for(var b=0;b<a;b++){var c=B[b].id,d=B[b].callbackFn,e={success:!1,id:c};if(0<N.pv[0]){var j=m(c);if(j)if(!o(B[b].swfVersion)||N.wk&&312>N.wk)if(B[b].expressInstall&&g()){e={},e.data=B[b].expressInstall,e.width=j.getAttribute("width")||"0",e.height=j.getAttribute("height")||"0",j.getAttribute("class")&&(e.styleclass=j.getAttribute("class")),j.getAttribute("align")&&(e.align=j.getAttribute("align"));for(var k={},j=j.getElementsByTagName("param"),l=j.length,n=0;n<l;n++)"movie"!=j[n].getAttribute("name").toLowerCase()&&(k[j[n].getAttribute("name")]=j[n].getAttribute("value"));h(e,k,c,d)}else i(j),d&&d(e);else q(c,!0),d&&(e.success=!0,e.ref=f(c),d(e))}else q(c,!0),d&&((c=f(c))&&typeof c.SetVariable!=s&&(e.success=!0,e.ref=c),d(e))}}function f(a){var b=null;return(a=m(a))&&"OBJECT"==a.nodeName&&(typeof a.SetVariable!=s?b=a:(a=a.getElementsByTagName(t)[0])&&(b=a)),b}function g(){return!J&&o("6.0.65")&&(N.win||N.mac)&&!(N.wk&&312>N.wk)}function h(a,b,c,d){J=!0,G=d||null,H={success:!1,id:c};var e=m(c);e&&("OBJECT"==e.nodeName?(E=j(e),F=null):(E=e,F=c),a.id=v,(typeof a.width==s||!/%$/.test(a.width)&&310>parseInt(a.width,10))&&(a.width="310"),(typeof a.height==s||!/%$/.test(a.height)&&137>parseInt(a.height,10))&&(a.height="137"),x.title=x.title.slice(0,47)+" - Flash Player Installation",d=N.ie&&N.win?["Active"].concat("").join("X"):"PlugIn",d="MMredirectURL="+w.location.toString().replace(/&/g,"%26")+"&MMplayerType="+d+"&MMdoctitle="+x.title,b.flashvars=typeof b.flashvars!=s?b.flashvars+("&"+d):d,N.ie&&N.win&&4!=e.readyState&&(d=x.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",c),e.parentNode.insertBefore(d,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()),k(a,b,c))}function i(a){if(N.ie&&N.win&&4!=a.readyState){var b=x.createElement("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(j(a),b),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(j(a),a)}function j(a){var b=x.createElement("div");if(N.win&&N.ie)b.innerHTML=a.innerHTML;else if((a=a.getElementsByTagName(t)[0])&&(a=a.childNodes))for(var c=a.length,d=0;d<c;d++)!(1==a[d].nodeType&&"PARAM"==a[d].nodeName)&&8!=a[d].nodeType&&b.appendChild(a[d].cloneNode(!0));return b}function k(a,b,c){var d,e=m(c);if(N.wk&&312>N.wk)return d;if(e)if(typeof a.id==s&&(a.id=c),N.ie&&N.win){var g,f="";for(g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));g="";for(var h in b)b[h]!=Object.prototype[h]&&(g+='<param name="'+h+'" value="'+b[h]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+g+"</object>",C[C.length]=a.id,d=m(a.id)}else{h=x.createElement(t),h.setAttribute("type",u);for(var i in a)a[i]!=Object.prototype[i]&&("styleclass"==i.toLowerCase()?h.setAttribute("class",a[i]):"classid"!=i.toLowerCase()&&h.setAttribute(i,a[i]));for(f in b)b[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&(a=h,g=f,i=b[f],c=x.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",i),a.appendChild(c));e.parentNode.replaceChild(h,e),d=h}return d}function l(a){var b=m(a);b&&"OBJECT"==b.nodeName&&(N.ie&&N.win?(b.style.display="none",function(){if(4==b.readyState){var c=m(a);if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function m(a){var b=null;try{b=x.getElementById(a)}catch(a){}return b}function n(a,b,c){a.attachEvent(b,c),D[D.length]=[a,b,c]}function o(a){var b=N.pv,a=a.split(".");return a[0]=parseInt(a[0],10),a[1]=parseInt(a[1],10)||0,a[2]=parseInt(a[2],10)||0,b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]}function p(a,b,c,d){if(!N.ie||!N.mac){var e=x.getElementsByTagName("head")[0];e&&(c=c&&"string"==typeof c?c:"screen",d&&(L=K=null),K&&L==c||(d=x.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),K=e.appendChild(d),N.ie&&N.win&&typeof x.styleSheets!=s&&0<x.styleSheets.length&&(K=x.styleSheets[x.styleSheets.length-1]),L=c),N.ie&&N.win?K&&typeof K.addRule==t&&K.addRule(a,b):K&&typeof x.createTextNode!=s&&K.appendChild(x.createTextNode(a+" {"+b+"}")))}}function q(a,b){if(M){var c=b?"visible":"hidden";I&&m(a)?m(a).style.visibility=c:p("#"+a,"visibility:"+c)}}function r(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=s?encodeURIComponent(a):a}var E,F,G,H,K,L,s="undefined",t="object",u="application/x-shockwave-flash",v="SWFObjectExprInst",w=window,x=document,y=navigator,z=!1,A=[function(){z?d():e()}],B=[],C=[],D=[],I=!1,J=!1,M=!0,N=function(){var a=typeof x.getElementById!=s&&typeof x.getElementsByTagName!=s&&typeof x.createElement!=s,b=y.userAgent.toLowerCase(),c=y.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=!!/webkit/.test(b)&&parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")),e=!1,f=[0,0,0],g=null;if(typeof y.plugins!=s&&typeof y.plugins["Shockwave Flash"]==t)!(g=y.plugins["Shockwave Flash"].description)||typeof y.mimeTypes!=s&&y.mimeTypes[u]&&!y.mimeTypes[u].enabledPlugin||(z=!0,e=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),f[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),f[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),f[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof w[["Active"].concat("Object").join("X")]!=s)try{var h=new(window[["Active"].concat("Object").join("X")])("ShockwaveFlash.ShockwaveFlash");h&&(g=h.GetVariable("$version"))&&(e=!0,g=g.split(" ")[1].split(","),f=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)])}catch(a){}return{w3:a,pv:f,wk:b,ie:e,win:d,mac:c}}();return function(){N.w3&&((typeof x.readyState!=s&&"complete"==x.readyState||typeof x.readyState==s&&(x.getElementsByTagName("body")[0]||x.body))&&a(),I||(typeof x.addEventListener!=s&&x.addEventListener("DOMContentLoaded",a,!1),N.ie&&N.win&&(x.attachEvent("onreadystatechange",function(){"complete"==x.readyState&&(x.detachEvent("onreadystatechange",arguments.callee),a())}),w==top&&function(){if(!I){try{x.documentElement.doScroll("left")}catch(a){return void setTimeout(arguments.callee,0)}a()}}()),N.wk&&function(){I||(/loaded|complete/.test(x.readyState)?a():setTimeout(arguments.callee,0))}(),c(a)))}(),function(){N.ie&&N.win&&window.attachEvent("onunload",function(){for(var a=D.length,b=0;b<a;b++)D[b][0].detachEvent(D[b][1],D[b][2]);for(a=C.length,b=0;b<a;b++)l(C[b]);for(var c in N)N[c]=null;N=null;for(var d in swfobject)swfobject[d]=null;swfobject=null})}(),{registerObject:function(a,b,c,d){if(N.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,B[B.length]=e,q(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(N.w3)return f(a)},embedSWF:function(a,c,d,e,f,i,j,l,m,n){var p={success:!1,id:c};N.w3&&!(N.wk&&312>N.wk)&&a&&c&&d&&e&&f?(q(c,!1),b(function(){d+="",e+="";var b={};if(m&&typeof m===t)for(var r in m)b[r]=m[r];if(b.data=a,b.width=d,b.height=e,r={},l&&typeof l===t)for(var u in l)r[u]=l[u];if(j&&typeof j===t)for(var v in j)r.flashvars=typeof r.flashvars!=s?r.flashvars+("&"+v+"="+j[v]):v+"="+j[v];if(o(f))u=k(b,r,c),b.id==c&&q(c,!0),p.success=!0,p.ref=u;else{if(i&&g())return b.data=i,void h(b,r,c,n);q(c,!0)}n&&n(p)})):n&&n(p)},switchOffAutoHideShow:function(){M=!1},ua:N,getFlashPlayerVersion:function(){return{major:N.pv[0],minor:N.pv[1],release:N.pv[2]}},hasFlashPlayerVersion:o,createSWF:function(a,b,c){if(N.w3)return k(a,b,c)},showExpressInstall:function(a,b,c,d){N.w3&&g()&&h(a,b,c,d)},removeSWF:function(a){N.w3&&l(a)},createCSS:function(a,b,c,d){N.w3&&p(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=x.location.search||x.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return r(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return r(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(J){var a=m(v);a&&E&&(a.parentNode.replaceChild(E,a),F&&(q(F,!0),N.ie&&N.win&&(E.style.display="block")),G&&G(H)),J=!1}}}}();!function(){if("undefined"!=typeof window&&!window.WebSocket){var a=window.console;a&&a.log&&a.error||(a={log:function(){},error:function(){}}),swfobject.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&a.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,b,c,d,e){var f=this;f.__id=WebSocket.__nextId++,WebSocket.__instances[f.__id]=f,
f.readyState=WebSocket.CONNECTING,f.bufferedAmount=0,f.__events={},b?"string"==typeof b&&(b=[b]):b=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(f.__id,a,b,c||null,d||0,e||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";return a=WebSocket.__flash.send(this.__id,encodeURIComponent(a)),0>a||(this.bufferedAmount+=a,!1)},WebSocket.prototype.close=function(){this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING||(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(a,b){a in this.__events||(this.__events[a]=[]),this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b){if(a in this.__events)for(var c=this.__events[a],d=c.length-1;0<=d;--d)if(c[d]===b){c.splice(d,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],c=0;c<b.length;++c)b[c](a);(b=this["on"+a.type])&&b(a)},WebSocket.prototype.__handleEvent=function(a){if("readyState"in a&&(this.readyState=a.readyState),"protocol"in a&&(this.protocol=a.protocol),"open"==a.type||"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==a.type)a=this.__createSimpleEvent("close");else{if("message"!=a.type)throw"unknown event type: "+a.type;a=this.__createMessageEvent("message",decodeURIComponent(a.message))}this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");return b.initEvent(a,!1,!1),b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,b){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");return c.initMessageEvent("message",!1,!1,b,null,null,window,null),c}return{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var b=document.createElement("div");b.id="webSocketContainer",b.style.position="absolute",WebSocket.__isFlashLite()?(b.style.left="0px",b.style.top="0px"):(b.style.left="-100px",b.style.top="-100px");var c=document.createElement("div");c.id="webSocketFlash",b.appendChild(c),document.body.appendChild(b),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(b){b.success||a.error("[WebSocket] swfobject.embedSWF failed")})}else a.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf")},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var b=WebSocket.__flash.receiveEvents(),c=0;c<b.length;++c)WebSocket.__instances[b[c].webSocketId].__handleEvent(b[c])}catch(b){a.error(b)}},0),!0},WebSocket.__log=function(b){a.log(decodeURIComponent(b))},WebSocket.__error=function(b){a.error(decodeURIComponent(b))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return!!(a&&a.enabledPlugin&&a.enabledPlugin.filename)&&!!a.enabledPlugin.filename.match(/flashlite/i)},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))):a.error("Flash Player >= 10.0.0 is required.")}}(),function(a,b,c){function d(a){a&&(b.Transport.apply(this,arguments),this.sendBuffer=[])}function e(){}a.XHR=d,b.util.inherit(d,b.Transport),d.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},d.prototype.payload=function(a){for(var c=[],d=0,e=a.length;d<e;d++)c.push(b.parser.encodePacket(a[d]));this.send(b.parser.encodePayload(c))},d.prototype.send=function(a){return this.post(a),this},d.prototype.post=function(a){function b(){4==this.readyState&&(this.onreadystatechange=e,f.posting=!1,200==this.status?f.socket.setBuffer(!1):f.onClose())}function d(){this.onload=e,f.socket.setBuffer(!1)}var f=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),c.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=d:this.sendXHR.onreadystatechange=b,this.sendXHR.send(a)},d.prototype.close=function(){return this.onClose(),this},d.prototype.request=function(a){var c=b.util.request(this.socket.isXDomain()),d=b.util.query(this.socket.options.query,"t="+ +new Date);if(c.open(a||"GET",this.prepareUrl()+d,!0),"POST"==a)try{c.setRequestHeader?c.setRequestHeader("Content-type","text/plain;charset=UTF-8"):c.contentType="text/plain"}catch(a){}return c},d.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},d.check=function(a,d){try{var e=b.util.request(d),f=c.XDomainRequest&&e instanceof XDomainRequest,g=(a&&a.options&&a.options.secure?"https:":"http:")!=c.location.protocol;if(e&&(!f||!g))return!0}catch(a){}return!1},d.xdomainCheck=function(){return d.check(null,!0)}}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b){function c(a){b.Transport.XHR.apply(this,arguments)}a.htmlfile=c,b.util.inherit(c,b.Transport.XHR),c.prototype.name="htmlfile",c.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var a=this.doc.createElement("div");a.className="socketio",this.doc.body.appendChild(a),this.iframe=this.doc.createElement("iframe"),a.appendChild(this.iframe);var c=this,a=b.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+a,b.util.on(window,"unload",function(){c.destroy()})},c.prototype._=function(a,b){this.onData(a);try{var c=b.getElementsByTagName("script")[0];c.parentNode.removeChild(c)}catch(a){}},c.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(a){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},c.prototype.close=function(){return this.destroy(),b.Transport.XHR.prototype.close.call(this)},c.check=function(){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{return new(window[["Active"].concat("Object").join("X")])("htmlfile")&&b.Transport.XHR.check()}catch(a){}return!1},c.xdomainCheck=function(){return!1},b.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports),function(a,b,c){function d(){b.Transport.XHR.apply(this,arguments)}function e(){}a["xhr-polling"]=d,b.util.inherit(d,b.Transport.XHR),b.util.merge(d,b.Transport.XHR),d.prototype.name="xhr-polling",d.prototype.open=function(){return b.Transport.XHR.prototype.open.call(this),!1},d.prototype.get=function(){function a(){4==this.readyState&&(this.onreadystatechange=e,200==this.status?(f.onData(this.responseText),f.get()):f.onClose())}function b(){this.onerror=this.onload=e,f.onData(this.responseText),f.get()}function d(){f.onClose()}if(this.open){var f=this;this.xhr=this.request(),c.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=b,this.xhr.onerror=d):this.xhr.onreadystatechange=a,this.xhr.send(null)}},d.prototype.onClose=function(){if(b.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=e;try{this.xhr.abort()}catch(a){}this.xhr=null}},d.prototype.ready=function(a,c){var d=this;b.util.defer(function(){c.call(d)})},b.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this),function(a,b,c){function d(a){b.Transport["xhr-polling"].apply(this,arguments),this.index=b.j.length;var c=this;b.j.push(function(a){c._(a)})}var e=c.document&&"MozAppearance"in c.document.documentElement.style;a["jsonp-polling"]=d,b.util.inherit(d,b.Transport["xhr-polling"]),d.prototype.name="jsonp-polling",d.prototype.post=function(a){function c(){d(),e.socket.setBuffer(!1)}function d(){e.iframe&&e.form.removeChild(e.iframe);try{j=document.createElement('<iframe name="'+e.iframeId+'">')}catch(a){j=document.createElement("iframe"),j.name=e.iframeId}j.id=e.iframeId,e.form.appendChild(j),e.iframe=j}var e=this,f=b.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var j,g=document.createElement("form"),h=document.createElement("textarea"),i=this.iframeId="socketio_iframe_"+this.index;g.className="socketio",g.style.position="absolute",g.style.top="0px",g.style.left="0px",g.style.display="none",g.target=i,g.method="POST",g.setAttribute("accept-charset","utf-8"),h.name="d",g.appendChild(h),document.body.appendChild(g),this.form=g,this.area=h}this.form.action=this.prepareUrl()+f,d(),this.area.value=b.JSON.stringify(a);try{this.form.submit()}catch(a){}this.iframe.attachEvent?j.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c,this.socket.setBuffer(!0)},d.prototype.get=function(){var a=this,c=document.createElement("script"),d=b.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),c.async=!0,c.src=this.prepareUrl()+d,c.onerror=function(){a.onClose()},d=document.getElementsByTagName("script")[0],d.parentNode.insertBefore(c,d),this.script=c,e&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},d.prototype._=function(a){return this.onData(a),this.open&&this.get(),this},d.prototype.ready=function(a,c){var d=this;return e?void b.util.load(function(){c.call(d)}):c.call(this)},d.check=function(){return"document"in c},d.xdomainCheck=function(){return!0},b.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,"undefined"!=typeof io?io:module.parent.exports,this);var Erizo=Erizo||{};Erizo.EventDispatcher=function(a){var b={};return a.dispatcher={},a.dispatcher.eventListeners={},b.addEventListener=function(b,c){void 0===a.dispatcher.eventListeners[b]&&(a.dispatcher.eventListeners[b]=[]),a.dispatcher.eventListeners[b].push(c)},b.removeEventListener=function(b,c){var d;d=a.dispatcher.eventListeners[b].indexOf(c),-1!==d&&a.dispatcher.eventListeners[b].splice(d,1)},b.dispatchEvent=function(b){var c;L.Logger.debug("Event: "+b.type);for(c in a.dispatcher.eventListeners[b.type])a.dispatcher.eventListeners[b.type].hasOwnProperty(c)&&a.dispatcher.eventListeners[b.type][c](b)},b},Erizo.LicodeEvent=function(a){var b={};return b.type=a.type,b},Erizo.RoomEvent=function(a){var b=Erizo.LicodeEvent(a);return b.streams=a.streams,b.message=a.message,b},Erizo.StreamEvent=function(a){var b=Erizo.LicodeEvent(a);return b.stream=a.stream,b.msg=a.msg,b.bandwidth=a.bandwidth,b},Erizo.PublisherEvent=function(a){return Erizo.LicodeEvent(a)},Erizo=Erizo||{},Erizo.FcStack=function(a){var b={pcConfig:{},peerConnection:{},desc:{},signalCallback:void 0,close:function(){console.log("Close FcStack")},createOffer:function(){console.log("FCSTACK: CreateOffer")},addStream:function(a){console.log("FCSTACK: addStream",a)},processSignalingMessage:function(a){console.log("FCSTACK: processSignaling",a),void 0!==b.signalCallback&&b.signalCallback(a)},sendSignalingMessage:function(b){console.log("FCSTACK: Sending signaling Message",b),a.callback(b)},setSignalingCallback:function(a){console.log("FCSTACK: Setting signalling callback"),b.signalCallback=a}};return b},Erizo=Erizo||{},Erizo.BowserStack=function(a){var b={},c=webkitRTCPeerConnection;b.pcConfig={iceServers:[]},b.con={optional:[{DtlsSrtpKeyAgreement:!0}]},void 0!==a.stunServerUrl&&b.pcConfig.iceServers.push({url:a.stunServerUrl}),(a.turnServer||{}).url&&b.pcConfig.iceServers.push({username:a.turnServer.username,credential:a.turnServer.password,url:a.turnServer.url}),void 0===a.audio&&(a.audio=!0),void 0===a.video&&(a.video=!0),b.mediaConstraints={offerToReceiveVideo:a.video,offerToReceiveAudio:a.audio},b.peerConnection=new c(b.pcConfig,b.con),a.remoteDescriptionSet=!1;var d=function(b){var c,d;return a.maxVideoBW&&(c=b.match(/m=video.*\r\n/),null==c&&(c=b.match(/m=video.*\n/)),c&&c.length>0&&(d=c[0]+"b=AS:"+a.maxVideoBW+"\r\n",b=b.replace(c[0],d))),a.maxAudioBW&&(c=b.match(/m=audio.*\r\n/),null==c&&(c=b.match(/m=audio.*\n/)),c&&c.length>0&&(d=c[0]+"b=AS:"+a.maxAudioBW+"\r\n",b=b.replace(c[0],d))),b};b.close=function(){b.state="closed",b.peerConnection.close()},a.localCandidates=[],b.peerConnection.onicecandidate=function(c){c.candidate?(c.candidate.candidate.match(/a=/)||(c.candidate.candidate="a="+c.candidate.candidate),a.remoteDescriptionSet?a.callback({type:"candidate",candidate:c.candidate}):a.localCandidates.push(c.candidate)):console.log("End of candidates.",b.peerConnection.localDescription)},b.peerConnection.onaddstream=function(a){b.onaddstream&&b.onaddstream(a)},b.peerConnection.onremovestream=function(a){b.onremovestream&&b.onremovestream(a)};var f,e=function(a){console.log("Error in Stack ",a)},g=function(c){c.sdp=d(c.sdp),console.log("Set local description",c.sdp),f=c,b.peerConnection.setLocalDescription(f,function(){console.log("The final LocalDesc",b.peerConnection.localDescription),a.callback(b.peerConnection.localDescription)},e)},h=function(c){c.sdp=d(c.sdp),a.callback(c),f=c,b.peerConnection.setLocalDescription(c)};return b.createOffer=function(a){a===!0?b.peerConnection.createOffer(g,e,b.mediaConstraints):b.peerConnection.createOffer(g,e)},b.addStream=function(a){b.peerConnection.addStream(a)},a.remoteCandidates=[],b.processSignalingMessage=function(c){if(console.log("Process Signaling Message",c),"offer"===c.type)c.sdp=d(c.sdp),b.peerConnection.setRemoteDescription(new RTCSessionDescription(c)),b.peerConnection.createAnswer(h,null,b.mediaConstraints),a.remoteDescriptionSet=!0;else if("answer"===c.type)console.log("Set remote description",c.sdp),c.sdp=d(c.sdp),b.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){for(a.remoteDescriptionSet=!0,console.log("Candidates to be added: ",a.remoteCandidates.length);a.remoteCandidates.length>0;)console.log("Candidate :",a.remoteCandidates[a.remoteCandidates.length-1]),b.peerConnection.addIceCandidate(a.remoteCandidates.shift(),function(){},e);for(;a.localCandidates.length>0;)a.callback({type:"candidate",candidate:a.localCandidates.shift()})},function(){console.log("Error Setting Remote Description")});else if("candidate"===c.type){console.log("Message with candidate");try{var f;f="object"==typeof c.candidate?c.candidate:JSON.parse(c.candidate),f.candidate=f.candidate.replace(/a=/g,""),f.sdpMLineIndex=parseInt(f.sdpMLineIndex),f.sdpMLineIndex="audio"===f.sdpMid?0:1;var g=new RTCIceCandidate(f);console.log("Remote Candidate",g),a.remoteDescriptionSet?b.peerConnection.addIceCandidate(g,function(){},e):a.remoteCandidates.push(g)}catch(a){L.Logger.error("Error parsing candidate",c.candidate)}}},b},Erizo=Erizo||{},Erizo.FirefoxStack=function(a){var b={},c=mozRTCSessionDescription,d=mozRTCIceCandidate;b.pcConfig={iceServers:[]},void 0!==a.iceServers&&(b.pcConfig.iceServers=a.iceServers),void 0===a.audio&&(a.audio=!0),void 0===a.video&&(a.video=!0),b.mediaConstraints={offerToReceiveAudio:a.audio,offerToReceiveVideo:a.video,mozDontOfferDataChannel:!0};var e=function(a){L.Logger.error("Error in Stack ",a)},f=!1;b.peerConnection=new mozRTCPeerConnection(b.pcConfig,b.con),a.localCandidates=[],b.peerConnection.onicecandidate=function(b){var c={};b.candidate?(f=!0,b.candidate.candidate.match(/a=/)||(b.candidate.candidate="a="+b.candidate.candidate),c=b.candidate,a.remoteDescriptionSet?a.callback({type:"candidate",candidate:c}):(a.localCandidates.push(c),L.Logger.debug("Local Candidates stored: ",a.localCandidates.length,a.localCandidates))):L.Logger.info("Gathered all candidates. Sending END candidate")},b.peerConnection.onaddstream=function(a){b.onaddstream&&b.onaddstream(a)},b.peerConnection.onremovestream=function(a){b.onremovestream&&b.onremovestream(a)},b.peerConnection.oniceconnectionstatechange=function(a){b.oniceconnectionstatechange&&b.oniceconnectionstatechange(a.target.iceConnectionState)};var h,g=function(b){var c,d;return a.video&&a.maxVideoBW&&(b=b.replace(/b=AS:.*\r\n/g,""),d=b.match(/m=video.*\r\n/),null==d&&(d=b.match(/m=video.*\n/)),d&&d.length>0&&(c=d[0]+"b=AS:"+a.maxVideoBW+"\r\n",b=b.replace(d[0],c))),a.audio&&a.maxAudioBW&&(d=b.match(/m=audio.*\r\n/),null==d&&(d=b.match(/m=audio.*\n/)),d&&d.length>0&&(c=d[0]+"b=AS:"+a.maxAudioBW+"\r\n",b=b.replace(d[0],c))),b},i=function(b){b.sdp=g(b.sdp),b.sdp=b.sdp.replace(/a=ice-options:google-ice\r\n/g,""),a.callback(b),h=b},j=function(c){c.sdp=g(c.sdp),c.sdp=c.sdp.replace(/a=ice-options:google-ice\r\n/g,""),a.callback(c),h=c,b.peerConnection.setLocalDescription(h)};return b.updateSpec=function(b){(b.maxVideoBW||b.maxAudioBW)&&(b.maxVideoBW&&(L.Logger.debug("Maxvideo Requested",b.maxVideoBW,"limit",a.limitMaxVideoBW),b.maxVideoBW>a.limitMaxVideoBW&&(b.maxVideoBW=a.limitMaxVideoBW),a.maxVideoBW=b.maxVideoBW,L.Logger.debug("Result",a.maxVideoBW)),b.maxAudioBW&&(b.maxAudioBW>a.limitMaxAudioBW&&(b.maxAudioBW=a.limitMaxAudioBW),a.maxAudioBW=b.maxAudioBW),h.sdp=g(h.sdp),b.Sdp?L.Logger.error("Cannot update with renegotiation in Firefox, try without renegotiation"):(L.Logger.debug("Updating without renegotiation, newVideoBW:",a.maxVideoBW,", newAudioBW:",a.maxAudioBW),a.callback({type:"updatestream",sdp:h.sdp}))),(b.minVideoBW||void 0!==b.slideShowMode||void 0!==b.muteStream)&&(L.Logger.debug("MinVideo Changed to ",b.minVideoBW),L.Logger.debug("SlideShowMode Changed to ",b.slideShowMode),L.Logger.debug("muteStream changed to ",b.muteStream),a.callback({type:"updatestream",config:b}))},b.createOffer=function(a){a===!0?b.peerConnection.createOffer(i,e,b.mediaConstraints):b.peerConnection.createOffer(i,e)},b.addStream=function(a){b.peerConnection.addStream(a)},a.remoteCandidates=[],a.remoteDescriptionSet=!1,b.close=function(){b.state="closed",b.peerConnection.close()},b.processSignalingMessage=function(e){if("offer"===e.type)e.sdp=g(e.sdp),b.peerConnection.setRemoteDescription(new c(e),function(){b.peerConnection.createAnswer(j,function(a){L.Logger.error("Error",a)},b.mediaConstraints),a.remoteDescriptionSet=!0},function(a){L.Logger.error("Error setting Remote Description",a)});else if("answer"===e.type)L.Logger.info("Set remote and local description"),L.Logger.debug("Local Description to set",h.sdp),L.Logger.debug("Remote Description to set",e.sdp),e.sdp=g(e.sdp),b.peerConnection.setLocalDescription(h,function(){b.peerConnection.setRemoteDescription(new c(e),function(){for(a.remoteDescriptionSet=!0,L.Logger.info("Remote Description successfully set");a.remoteCandidates.length>0&&f;)L.Logger.info("Setting stored remote candidates"),b.peerConnection.addIceCandidate(a.remoteCandidates.shift());for(;a.localCandidates.length>0;)L.Logger.info("Sending Candidate from list"),a.callback({type:"candidate",candidate:a.localCandidates.shift()})},function(a){L.Logger.error("Error Setting Remote Description",a)})},function(a){L.Logger.error("Failure setting Local Description",a)});else if("candidate"===e.type)try{var i;i="object"==typeof e.candidate?e.candidate:JSON.parse(e.candidate),i.candidate=i.candidate.replace(/ generation 0/g,""),i.candidate=i.candidate.replace(/ udp /g," UDP "),i.sdpMLineIndex=parseInt(i.sdpMLineIndex);var k=new d(i);if(a.remoteDescriptionSet&&f)for(b.peerConnection.addIceCandidate(k);a.remoteCandidates.length>0;)L.Logger.info("Setting stored remote candidates"),b.peerConnection.addIceCandidate(a.remoteCandidates.shift());else a.remoteCandidates.push(k)}catch(a){L.Logger.error("Error parsing candidate",e.candidate,a)}},b},Erizo=Erizo||{},Erizo.ChromeStableStack=function(a){var b={pcConfig:{iceServers:[]},con:{optional:[{DtlsSrtpKeyAgreement:!0}]}};void 0!==a.iceServers&&(b.pcConfig.iceServers=a.iceServers),void 0===a.audio&&(a.audio=!0),void 0===a.video&&(a.video=!0),b.mediaConstraints={mandatory:{OfferToReceiveVideo:a.video,OfferToReceiveAudio:a.audio}};var c=function(a){L.Logger.error("Error in Stack ",a)};b.peerConnection=new webkitRTCPeerConnection(b.pcConfig,b.con);var d=function(b){var c,d;return a.video&&a.maxVideoBW&&(b=b.replace(/b=AS:.*\r\n/g,""),d=b.match(/m=video.*\r\n/),null==d&&(d=b.match(/m=video.*\n/)),d&&d.length>0&&(c=d[0]+"b=AS:"+a.maxVideoBW+"\r\n",b=b.replace(d[0],c))),a.audio&&a.maxAudioBW&&(d=b.match(/m=audio.*\r\n/),null==d&&(d=b.match(/m=audio.*\n/)),d&&d.length>0&&(c=d[0]+"b=AS:"+a.maxAudioBW+"\r\n",b=b.replace(d[0],c))),b};b.close=function(){b.state="closed",b.peerConnection.close()},a.localCandidates=[],b.peerConnection.onicecandidate=function(b){var c={};b.candidate?(b.candidate.candidate.match(/a=/)||(b.candidate.candidate="a="+b.candidate.candidate),c={sdpMLineIndex:b.candidate.sdpMLineIndex,sdpMid:b.candidate.sdpMid,candidate:b.candidate.candidate}):(L.Logger.info("Gathered all candidates. Sending END candidate"),c={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"}),a.remoteDescriptionSet?a.callback({type:"candidate",candidate:c}):(a.localCandidates.push(c),L.Logger.info("Storing candidate: ",a.localCandidates.length,c))},b.peerConnection.onaddstream=function(a){b.onaddstream&&b.onaddstream(a)},b.peerConnection.onremovestream=function(a){b.onremovestream&&b.onremovestream(a)},b.peerConnection.oniceconnectionstatechange=function(a){b.oniceconnectionstatechange&&b.oniceconnectionstatechange(a.target.iceConnectionState)};var e,f,g=function(b){b.sdp=d(b.sdp);var f,c=b.sdp;f=c.match(/a=rtpmap:(.*)opus.*\r\n/),null!==f&&(c=c.replace(f[0],f[0]+"a=rtcp-fb:"+f[1]+"nack\r\n")),b.sdp=c,b.sdp=b.sdp.replace(/a=ice-options:google-ice\r\n/g,""),a.callback({type:b.type,sdp:b.sdp}),e=b},h=function(c){c.sdp=d(c.sdp),a.callback({type:c.type,sdp:c.sdp}),e=c,b.peerConnection.setLocalDescription(c)};return b.updateSpec=function(c,g){(c.maxVideoBW||c.maxAudioBW)&&(c.maxVideoBW&&(L.Logger.debug("Maxvideo Requested:",c.maxVideoBW,"limit:",a.limitMaxVideoBW),c.maxVideoBW>a.limitMaxVideoBW&&(c.maxVideoBW=a.limitMaxVideoBW),a.maxVideoBW=c.maxVideoBW,L.Logger.debug("Result",a.maxVideoBW)),c.maxAudioBW&&(c.maxAudioBW>a.limitMaxAudioBW&&(c.maxAudioBW=a.limitMaxAudioBW),a.maxAudioBW=c.maxAudioBW),e.sdp=d(e.sdp),c.Sdp||c.maxAudioBW?(L.Logger.debug("Updating with SDP renegotiation",a.maxVideoBW),b.peerConnection.setLocalDescription(e,function(){f.sdp=d(f.sdp),b.peerConnection.setRemoteDescription(new RTCSessionDescription(f),function(){a.remoteDescriptionSet=!0,a.callback({type:"updatestream",sdp:e.sdp})})},function(a){L.Logger.error("Error updating configuration",a),g("error")})):(L.Logger.debug("Updating without SDP renegotiation, newVideoBW:",a.maxVideoBW,"newAudioBW:",a.maxAudioBW),a.callback({type:"updatestream",sdp:e.sdp}))),(c.minVideoBW||void 0!==c.slideShowMode||void 0!==c.muteStream)&&(L.Logger.debug("MinVideo Changed to ",c.minVideoBW),L.Logger.debug("SlideShowMode Changed to ",c.slideShowMode),L.Logger.debug("muteStream changed to ",c.muteStream),a.callback({type:"updatestream",config:c}))},b.createOffer=function(a){a===!0?b.peerConnection.createOffer(g,c,b.mediaConstraints):b.peerConnection.createOffer(g,c)},b.addStream=function(a){b.peerConnection.addStream(a)},a.remoteCandidates=[],a.remoteDescriptionSet=!1,b.processSignalingMessage=function(c){if("offer"===c.type)c.sdp=d(c.sdp),b.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){b.peerConnection.createAnswer(h,function(a){L.Logger.error("Error: ",a)},b.mediaConstraints),a.remoteDescriptionSet=!0},function(a){L.Logger.error("Error setting Remote Description",a)});else if("answer"===c.type)L.Logger.info("Set remote and local description"),L.Logger.debug("Remote Description",c.sdp),L.Logger.debug("Local Description",e.sdp),c.sdp=d(c.sdp),f=c,b.peerConnection.setLocalDescription(e,function(){b.peerConnection.setRemoteDescription(new RTCSessionDescription(c),function(){for(a.remoteDescriptionSet=!0,L.Logger.info("Candidates to be added: ",a.remoteCandidates.length,a.remoteCandidates);a.remoteCandidates.length>0;)b.peerConnection.addIceCandidate(a.remoteCandidates.shift());for(L.Logger.info("Local candidates to send:",a.localCandidates.length);a.localCandidates.length>0;)a.callback({type:"candidate",candidate:a.localCandidates.shift()})})});else if("candidate"===c.type)try{var g;g="object"==typeof c.candidate?c.candidate:JSON.parse(c.candidate),g.candidate=g.candidate.replace(/a=/g,""),g.sdpMLineIndex=parseInt(g.sdpMLineIndex);var i=new RTCIceCandidate(g);a.remoteDescriptionSet?b.peerConnection.addIceCandidate(i):a.remoteCandidates.push(i)}catch(a){L.Logger.error("Error parsing candidate",c.candidate)}},b},Erizo=Erizo||{},Erizo.ChromeCanaryStack=function(a){var b={},c=webkitRTCPeerConnection;b.pcConfig={iceServers:[]},b.con={optional:[{DtlsSrtpKeyAgreement:!0}]},void 0!==a.stunServerUrl&&b.pcConfig.iceServers.push({url:a.stunServerUrl}),(a.turnServer||{}).url&&b.pcConfig.iceServers.push({username:a.turnServer.username,credential:a.turnServer.password,url:a.turnServer.url}),(void 0===a.audio||a.nop2p)&&(a.audio=!0),(void 0===a.video||a.nop2p)&&(a.video=!0),b.mediaConstraints={mandatory:{OfferToReceiveVideo:a.video,OfferToReceiveAudio:a.audio}},b.roapSessionId=103,b.peerConnection=new c(b.pcConfig,b.con),b.peerConnection.onicecandidate=function(c){L.Logger.debug("PeerConnection: ",a.sessionId),c.candidate?b.iceCandidateCount+=1:(L.Logger.debug("State: "+b.peerConnection.iceGatheringState),void 0===b.ices&&(b.ices=0),b.ices+=1,1<=b.ices&&b.moreIceComing&&(b.moreIceComing=!1,b.markActionNeeded()))};var d=function(b){var c,d;return a.maxVideoBW&&(d=b.match(/m=video.*\r\n/))&&0<d.length&&(c=d[0]+"b=AS:"+a.maxVideoBW+"\r\n",b=b.replace(d[0],c)),a.maxAudioBW&&(d=b.match(/m=audio.*\r\n/))&&0<d.length&&(c=d[0]+"b=AS:"+a.maxAudioBW+"\r\n",b=b.replace(d[0],c)),b};return b.processSignalingMessage=function(a){L.Logger.debug("Activity on conn "+b.sessionId),a=JSON.parse(a),b.incomingMessage=a,"new"===b.state?"OFFER"===a.messageType?(a={sdp:a.sdp,type:"offer"},b.peerConnection.setRemoteDescription(new RTCSessionDescription(a)),b.state="offer-received",b.markActionNeeded()):b.error("Illegal message for this state: "+a.messageType+" in state "+b.state):"offer-sent"===b.state?"ANSWER"===a.messageType?(a={sdp:a.sdp,type:"answer"},L.Logger.debug("Received ANSWER: ",a.sdp),a.sdp=d(a.sdp),b.peerConnection.setRemoteDescription(new RTCSessionDescription(a)),b.sendOK(),b.state="established"):"pr-answer"===a.messageType?(a={sdp:a.sdp,type:"pr-answer"},b.peerConnection.setRemoteDescription(new RTCSessionDescription(a))):"offer"===a.messageType?b.error("Not written yet"):b.error("Illegal message for this state: "+a.messageType+" in state "+b.state):"established"===b.state&&("OFFER"===a.messageType?(a={sdp:a.sdp,type:"offer"},b.peerConnection.setRemoteDescription(new RTCSessionDescription(a)),b.state="offer-received",b.markActionNeeded()):b.error("Illegal message for this state: "+a.messageType+" in state "+b.state))},b.addStream=function(a){b.peerConnection.addStream(a),b.markActionNeeded()},b.removeStream=function(){b.markActionNeeded()},b.close=function(){b.state="closed",b.peerConnection.close()},b.markActionNeeded=function(){b.actionNeeded=!0,b.doLater(function(){b.onstablestate()})},b.doLater=function(a){window.setTimeout(a,1)},b.onstablestate=function(){var a;if(b.actionNeeded){if("new"===b.state||"established"===b.state)b.peerConnection.createOffer(function(a){a.sdp=d(a.sdp),L.Logger.debug("Changed",a.sdp),a.sdp!==b.prevOffer?(b.peerConnection.setLocalDescription(a),b.state="preparing-offer",b.markActionNeeded()):L.Logger.debug("Not sending a new offer")},null,b.mediaConstraints);else if("preparing-offer"===b.state){if(b.moreIceComing)return;b.prevOffer=b.peerConnection.localDescription.sdp,L.Logger.debug("Sending OFFER: "+b.prevOffer),b.sendMessage("OFFER",b.prevOffer),b.state="offer-sent"}else if("offer-received"===b.state)b.peerConnection.createAnswer(function(a){b.peerConnection.setLocalDescription(a),b.state="offer-received-preparing-answer",b.iceStarted?b.markActionNeeded():(L.Logger.debug((new Date).getTime()+": Starting ICE in responder"),b.iceStarted=!0)},null,b.mediaConstraints);else if("offer-received-preparing-answer"===b.state){if(b.moreIceComing)return;a=b.peerConnection.localDescription.sdp,b.sendMessage("ANSWER",a),b.state="established"}else b.error("Dazed and confused in state "+b.state+", stopping here");b.actionNeeded=!1}},b.sendOK=function(){b.sendMessage("OK")},b.sendMessage=function(a,c){var d={};d.messageType=a,d.sdp=c,"OFFER"===a?(d.offererSessionId=b.sessionId,d.answererSessionId=b.otherSessionId,d.seq=b.sequenceNumber+=1,d.tiebreaker=Math.floor(429496723*Math.random()+1)):(d.offererSessionId=b.incomingMessage.offererSessionId,d.answererSessionId=b.sessionId,d.seq=b.incomingMessage.seq),b.onsignalingmessage(JSON.stringify(d))},b.error=function(a){throw"Error in RoapOnJsep: "+a},b.sessionId=b.roapSessionId+=1,b.sequenceNumber=0,b.actionNeeded=!1,b.iceStarted=!1,b.moreIceComing=!0,b.iceCandidateCount=0,b.onsignalingmessage=a.callback,b.peerConnection.onopen=function(){b.onopen&&b.onopen()},b.peerConnection.onaddstream=function(a){b.onaddstream&&b.onaddstream(a)},b.peerConnection.onremovestream=function(a){b.onremovestream&&b.onremovestream(a)},b.peerConnection.oniceconnectionstatechange=function(a){b.oniceconnectionstatechange&&b.oniceconnectionstatechange(a.currentTarget.iceConnectionState)},b.onaddstream=null,b.onremovestream=null,b.state="new",b.markActionNeeded(),b},Erizo=Erizo||{},Erizo.sessionId=103,Erizo.Connection=function(a){var b={};if(a.sessionId=Erizo.sessionId+=1,b.browser=Erizo.getBrowser(),"fake"===b.browser)L.Logger.warning("Publish/subscribe video/audio streams not supported in erizofc yet"),b=Erizo.FcStack(a);else if("mozilla"===b.browser)L.Logger.debug("Firefox Stack"),b=Erizo.FirefoxStack(a);else if("bowser"===b.browser)L.Logger.debug("Bowser Stack"),b=Erizo.BowserStack(a);else{if("chrome-stable"!==b.browser)throw L.Logger.error("No stack available for this browser"),"WebRTC stack not available";L.Logger.debug("Chrome Stable Stack"),b=Erizo.ChromeStableStack(a)}return b.updateSpec||(b.updateSpec=function(a,b){L.Logger.error("Update Configuration not implemented in this browser"),b&&b("unimplemented")}),b},Erizo.getBrowser=function(){var a="none";return"undefined"!=typeof module&&module.exports?a="fake":null!==window.navigator.userAgent.match("Firefox")?a="mozilla":null!==window.navigator.userAgent.match("Bowser")?a="bowser":null!==window.navigator.userAgent.match("Chrome")?26<=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]&&(a="chrome-stable"):null!==window.navigator.userAgent.match("Safari")?a="bowser":null!==window.navigator.userAgent.match("AppleWebKit")&&(a="bowser"),a},Erizo.GetUserMedia=function(a,b,c){var d;if(navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,a.screen)switch(L.Logger.debug("Screen access requested"),Erizo.getBrowser()){case"mozilla":
L.Logger.debug("Screen sharing in Firefox"),d={},void 0!==a.video.mandatory?(d.video=a.video,d.video.mediaSource="window"):d={audio:a.audio,video:{mediaSource:"window"}},navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(d=navigator.mediaDevices.getUserMedia(d).then(b),d.catch(c)):navigator.getMedia(d,b,c);break;case"chrome-stable":L.Logger.debug("Screen sharing in Chrome"),d="okeephmleflklcdebijnponpabbmmgeo",a.extensionId&&(L.Logger.debug("extensionId supplied, using "+a.extensionId),d=a.extensionId),L.Logger.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(d,{getStream:!0},function(d){var e={};void 0===d?(L.Logger.error("Access to screen denied"),c({code:"Access to screen denied"})):(d=d.streamId,void 0!==a.video.mandatory?(e.video=a.video,e.video.mandatory.chromeMediaSource="desktop",e.video.mandatory.chromeMediaSourceId=d):e={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d}}},navigator.getMedia(e,b,c))})}catch(a){L.Logger.debug("Screensharing plugin is not accessible "),c({code:"no_plugin_present"});break}break;default:L.Logger.error("This browser does not support ScreenSharing")}else if("undefined"!=typeof module&&module.exports)L.Logger.error("Video/audio streams not supported in erizofc yet");else{if(a.video&&"mozilla"===Erizo.getBrowser()&&(void 0!==a.video.mandatory&&(d=a.video.mandatory,a.video={width:{min:d.minWidth,max:d.maxWidth},height:{min:d.minHeight,max:d.maxHeight}}),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia))return d=navigator.mediaDevices.getUserMedia(a).then(b),void d.catch(c);navigator.getMedia(a,b,c)}},Erizo=Erizo||{},Erizo.Stream=function(a){var c,b=Erizo.EventDispatcher(a);if(b.stream=a.stream,b.url=a.url,b.recording=a.recording,b.room=void 0,b.showing=!1,b.local=!1,b.video=a.video,b.audio=a.audio,b.screen=a.screen,b.videoSize=a.videoSize,b.extensionId=a.extensionId,!(void 0===b.videoSize||b.videoSize instanceof Array&&4===b.videoSize.length))throw Error("Invalid Video Size");return void 0!==a.local&&!0!==a.local||(b.local=!0),b.getID=function(){return b.local&&!a.streamID?"local":a.streamID},b.getAttributes=function(){return a.attributes},b.setAttributes=function(){L.Logger.error("Failed to set attributes data. This Stream object has not been published.")},b.updateLocalAttributes=function(b){a.attributes=b},b.hasAudio=function(){return a.audio},b.hasVideo=function(){return a.video},b.hasData=function(){return a.data},b.hasScreen=function(){return a.screen},b.sendData=function(){L.Logger.error("Failed to send data. This Stream object has not that channel enabled.")},b.init=function(){var c;try{if((a.audio||a.video||a.screen)&&void 0===a.url){L.Logger.info("Requested access to local media");var d=a.video;!0!==d&&!0!==a.screen||void 0===b.videoSize?!0===a.screen&&void 0===d&&(d=!0):d={mandatory:{minWidth:b.videoSize[0],minHeight:b.videoSize[1],maxWidth:b.videoSize[2],maxHeight:b.videoSize[3]}};var e={video:d,audio:a.audio,fake:a.fake,screen:a.screen,extensionId:b.extensionId};L.Logger.debug(e),Erizo.GetUserMedia(e,function(a){L.Logger.info("User has granted access to local media."),b.stream=a,c=Erizo.StreamEvent({type:"access-accepted"}),b.dispatchEvent(c)},function(a){L.Logger.error("Failed to get access to local media. Error code was "+a.code+"."),a=Erizo.StreamEvent({type:"access-denied",msg:a}),b.dispatchEvent(a)})}else c=Erizo.StreamEvent({type:"access-accepted"}),b.dispatchEvent(c)}catch(a){L.Logger.error("Failed to get access to local media. Error was "+a+"."),c=Erizo.StreamEvent({type:"access-denied",msg:a}),b.dispatchEvent(c)}},b.close=function(){b.local&&(void 0!==b.room&&b.room.unpublish(b),b.hide(),void 0!==b.stream&&b.stream.getTracks().forEach(function(a){a.stop()}),b.stream=void 0)},b.play=function(a,c){c=c||{},b.elementID=a;var d;b.hasVideo()||this.hasScreen()?void 0!==a&&(d=new Erizo.VideoPlayer({id:b.getID(),stream:b,elementID:a,options:c}),b.player=d,b.showing=!0):b.hasAudio&&(d=new Erizo.AudioPlayer({id:b.getID(),stream:b,elementID:a,options:c}),b.player=d,b.showing=!0)},b.stop=function(){b.showing&&void 0!==b.player&&(b.player.destroy(),b.showing=!1)},b.show=b.play,b.hide=b.stop,c=function(){if(void 0!==b.player&&void 0!==b.stream){var g,a=b.player.video,c=document.defaultView.getComputedStyle(a),d=parseInt(c.getPropertyValue("width"),10),e=parseInt(c.getPropertyValue("height"),10),f=parseInt(c.getPropertyValue("left"),10),c=parseInt(c.getPropertyValue("top"),10);g="object"==typeof b.elementID&&"function"==typeof b.elementID.appendChild?b.elementID:document.getElementById(b.elementID);var h=document.defaultView.getComputedStyle(g);g=parseInt(h.getPropertyValue("width"),10);var h=parseInt(h.getPropertyValue("height"),10),i=document.createElement("canvas");return i.id="testing",i.width=g,i.height=h,i.setAttribute("style","display: none"),i.getContext("2d").drawImage(a,f,c,d,e),i}return null},b.getVideoFrameURL=function(a){var b=c();return null!==b?a?b.toDataURL(a):b.toDataURL():null},b.getVideoFrame=function(){var a=c();return null!==a?a.getContext("2d").getImageData(0,0,a.width,a.height):null},b.checkOptions=function(a,c){!0===c?(a.video||a.audio||a.screen)&&(L.Logger.warning("Cannot update type of subscription"),a.video=void 0,a.audio=void 0,a.screen=void 0):!1===b.local&&(!0===a.video&&!1===b.hasVideo()&&(L.Logger.warning("Trying to subscribe to video when there is no video, won't subscribe to video"),a.video=!1),!0===a.audio&&!1===b.hasAudio())&&(L.Logger.warning("Trying to subscribe to audio when there is no audio, won't subscribe to audio"),a.audio=!1),!1===b.local&&!b.hasVideo()&&!0===a.slideShowMode&&(L.Logger.warning("Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),a.slideShowMode=!1)},b.muteAudio=function(a,c){if(b.room&&b.room.p2p)L.Logger.warning("muteAudio is not implemented in p2p streams"),c("error");else if(b.local)L.Logger.warning("muteAudio can only be used in remote streams"),c("Error");else{var d={muteStream:{audio:a}};b.checkOptions(d,!0),b.pc.updateSpec(d,c)}},b.updateConfiguration=function(a,c){if(void 0!==a)if(b.pc)if(b.checkOptions(a,!0),b.local)if(b.room.p2p)for(var d in b.pc)b.pc[d].updateSpec(a,c);else b.pc.updateSpec(a,c);else b.pc.updateSpec(a,c);else c("This stream has no peerConnection attached, ignoring")},b},Erizo=Erizo||{},Erizo.Room=function(a){var c,d,e,f,g,h,b=Erizo.EventDispatcher(a);return b.remoteStreams={},b.localStreams={},b.roomID="",b.socket={},b.state=0,b.p2p=!1,b.addEventListener("room-disconnected",function(){var a,c;b.state=0;for(a in b.remoteStreams)b.remoteStreams.hasOwnProperty(a)&&(c=b.remoteStreams[a],h(c),delete b.remoteStreams[a],c&&!c.failed&&(c=Erizo.StreamEvent({type:"stream-removed",stream:c}),b.dispatchEvent(c)));b.remoteStreams={};for(a in b.localStreams)if(b.localStreams.hasOwnProperty(a)){if(c=b.localStreams[a],b.p2p)for(var d in c.pc)c.pc[d].close();else c.pc.close();delete b.localStreams[a]}try{b.socket.disconnect()}catch(a){L.Logger.debug("Socket already disconnected")}b.socket=void 0}),h=function(a){void 0!==a.stream&&(a.hide(),a.pc&&a.pc.close(),a.local&&a.stream.stop(),delete a.stream)},f=function(a,b){a.local?d("sendDataStream",{id:a.getID(),msg:b}):L.Logger.error("You can not send data through a remote stream")},g=function(a,b){a.local?(a.updateLocalAttributes(b),d("updateStreamAttributes",{id:a.getID(),attrs:b})):L.Logger.error("You can not update attributes in a remote stream")},c=function(c,f,g){var i=function(c,d){c.pc=Erizo.Connection({callback:function(a){e("signaling_message",{streamId:c.getID(),peerSocket:d,msg:a})},iceServers:b.iceServers,maxAudioBW:a.maxAudioBW,maxVideoBW:a.maxVideoBW,limitMaxAudioBW:a.maxAudioBW,limitMaxVideoBW:a.maxVideoBW}),c.pc.onaddstream=function(a){L.Logger.info("Stream subscribed"),c.stream=a.stream,a=Erizo.StreamEvent({type:"stream-subscribed",stream:c}),b.dispatchEvent(a)}};b.socket=io.connect(c.host,{reconnect:!1,secure:c.secure,"force new connection":!0,transports:["websocket"]}),b.socket.on("onAddStream",function(a){var c=Erizo.Stream({streamID:a.id,local:!1,audio:a.audio,video:a.video,data:a.data,screen:a.screen,attributes:a.attributes});b.remoteStreams[a.id]=c,a=Erizo.StreamEvent({type:"stream-added",stream:c}),b.dispatchEvent(a)}),b.socket.on("signaling_message_erizo",function(a){var c;(c=a.peerId?b.remoteStreams[a.peerId]:b.localStreams[a.streamId])&&!c.failed&&c.pc.processSignalingMessage(a.mess)}),b.socket.on("signaling_message_peer",function(a){var c=b.localStreams[a.streamId];c&&!c.failed?c.pc[a.peerSocket].processSignalingMessage(a.msg):(c=b.remoteStreams[a.streamId],c.pc||i(c,a.peerSocket),c.pc.processSignalingMessage(a.msg))}),b.socket.on("publish_me",function(a){var c=b.localStreams[a.streamId];void 0===c.pc&&(c.pc={}),c.pc[a.peerSocket]=Erizo.Connection({callback:function(b){e("signaling_message",{streamId:a.streamId,peerSocket:a.peerSocket,msg:b})},audio:c.hasAudio(),video:c.hasVideo(),iceServers:b.iceServers}),c.pc[a.peerSocket].oniceconnectionstatechange=function(b){"failed"===b&&(c.pc[a.peerSocket].close(),delete c.pc[a.peerSocket])},c.pc[a.peerSocket].addStream(c.stream),c.pc[a.peerSocket].createOffer()}),b.socket.on("onBandwidthAlert",function(a){if(L.Logger.info("Bandwidth Alert on",a.streamID,"message",a.message,"BW:",a.bandwidth),a.streamID){var c=b.remoteStreams[a.streamID];c&&!c.failed&&(a=Erizo.StreamEvent({type:"bandwidth-alert",stream:c,msg:a.message,bandwidth:a.bandwidth}),c.dispatchEvent(a))}}),b.socket.on("onDataStream",function(a){var c=b.remoteStreams[a.id],a=Erizo.StreamEvent({type:"stream-data",msg:a.msg,stream:c});c.dispatchEvent(a)}),b.socket.on("onUpdateAttributeStream",function(a){var c=b.remoteStreams[a.id],d=Erizo.StreamEvent({type:"stream-attributes-update",attrs:a.attrs,stream:c});c.updateLocalAttributes(a.attrs),c.dispatchEvent(d)}),b.socket.on("onRemoveStream",function(a){var c=b.localStreams[a.id];c&&!c.failed?(c.failed=!0,L.Logger.warning("We received a removeStream from our own stream -- probably erizoJS timed out"),a=Erizo.StreamEvent({type:"stream-failed",msg:"Publishing local stream failed because of an Erizo Error",stream:c}),b.dispatchEvent(a),b.unpublish(c)):(c=b.remoteStreams[a.id])&&c.failed?L.Logger.debug("Received onRemoveStream for a stream that we already marked as failed ",a.id):c?(delete b.remoteStreams[a.id],h(c),c=Erizo.StreamEvent({type:"stream-removed",stream:c}),b.dispatchEvent(c)):L.Logger.debug("Received a removeStream for",a.id,"and it has not been registered here, ignoring.")}),b.socket.on("disconnect",function(){if(L.Logger.info("Socket disconnected, lost connection to ErizoController"),0!==b.state){L.Logger.error("Unexpected disconnection from ErizoController");var a=Erizo.RoomEvent({type:"room-disconnected",message:"unexpected-disconnection"});b.dispatchEvent(a)}}),b.socket.on("connection_failed",function(a){var c;"publish"===a.type?(L.Logger.error("ICE Connection Failed on publishing stream",a.streamId,b.state),0!==b.state&&a.streamId&&(a=b.localStreams[a.streamId])&&!a.failed&&(a.failed=!0,c=Erizo.StreamEvent({type:"stream-failed",msg:"Publishing local stream failed ICE Checks",stream:a}),b.dispatchEvent(c),b.unpublish(a))):(L.Logger.error("ICE Connection Failed on subscribe stream",a.streamId),0!==b.state&&a.streamId&&(a=b.remoteStreams[a.streamId])&&!a.failed&&(a.failed=!0,c=Erizo.StreamEvent({type:"stream-failed",msg:"Subscriber failed ICE, cannot reach Licode for media",stream:a}),b.dispatchEvent(c),b.unsubscribe(a)))}),b.socket.on("error",function(a){L.Logger.error("Cannot connect to erizo Controller"),g&&g("Cannot connect to ErizoController (socket.io error)",a)}),d("token",c,f,g)},d=function(a,c,d,e){b.socket.emit(a,c,function(a,b){"success"===a?d&&d(b):"error"===a?e&&e(b):d&&d(a,b)})},e=function(a,c,d,e){0!==b.state?b.socket.emit(a,c,d,function(a,b){e&&e(a,b)}):L.Logger.warning("Trying to send a message over a disconnected Socket")},b.connect=function(){var d=L.Base64.decodeBase64(a.token);0!==b.state&&L.Logger.warning("Room already connected"),b.state=1,c(JSON.parse(d),function(c){var f,g,h,d=0,e=[];f=c.streams||[],b.p2p=c.p2p,g=c.id,b.iceServers=c.iceServers,b.state=2,a.defaultVideoBW=c.defaultVideoBW,a.maxVideoBW=c.maxVideoBW;for(d in f)f.hasOwnProperty(d)&&(h=f[d],c=Erizo.Stream({streamID:h.id,local:!1,audio:h.audio,video:h.video,data:h.data,screen:h.screen,attributes:h.attributes}),e.push(c),b.remoteStreams[h.id]=c);b.roomID=g,L.Logger.info("Connected to room "+b.roomID),d=Erizo.RoomEvent({type:"room-connected",streams:e}),b.dispatchEvent(d)},function(a){L.Logger.error("Not Connected! Error: "+a),a=Erizo.RoomEvent({type:"room-error",message:a}),b.dispatchEvent(a)})},b.disconnect=function(){L.Logger.debug("Disconnection requested");var a=Erizo.RoomEvent({type:"room-disconnected",message:"expected-disconnection"});b.dispatchEvent(a)},b.publish=function(c,d,h){if(d=d||{},d.maxVideoBW=d.maxVideoBW||a.defaultVideoBW,d.maxVideoBW>a.maxVideoBW&&(d.maxVideoBW=a.maxVideoBW),void 0===d.minVideoBW&&(d.minVideoBW=0),d.minVideoBW>a.defaultVideoBW&&(d.minVideoBW=a.defaultVideoBW),c&&c.local&&void 0===b.localStreams[c.getID()])if(c.hasAudio()||c.hasVideo()||c.hasScreen())if(void 0!==c.url||void 0!==c.recording){var i,j;c.url?(i="url",j=c.url):(i="recording",j=c.recording),L.Logger.info("Checking publish options for",c.getID()),c.checkOptions(d),e("publish",{state:i,data:c.hasData(),audio:c.hasAudio(),video:c.hasVideo(),attributes:c.getAttributes(),metadata:d.metadata,createOffer:d.createOffer},j,function(a,d){null!==a?(L.Logger.info("Stream published"),c.getID=function(){return a},c.sendData=function(a){f(c,a)},c.setAttributes=function(a){g(c,a)},b.localStreams[a]=c,c.room=b,h&&h(a)):(L.Logger.error("Error when publishing stream",d),h&&h(void 0,d))})}else b.p2p?(a.maxAudioBW=d.maxAudioBW,a.maxVideoBW=d.maxVideoBW,e("publish",{state:"p2p",data:c.hasData(),audio:c.hasAudio(),video:c.hasVideo(),screen:c.hasScreen(),metadata:d.metadata,attributes:c.getAttributes()},void 0,function(a,d){null===a&&(L.Logger.error("Error when publishing the stream",d),h&&h(void 0,d)),L.Logger.info("Stream published"),c.getID=function(){return a},c.hasData()&&(c.sendData=function(a){f(c,a)}),c.setAttributes=function(a){g(c,a)},b.localStreams[a]=c,c.room=b})):(L.Logger.info("Publishing to Erizo Normally, is createOffer",d.createOffer),e("publish",{state:"erizo",data:c.hasData(),audio:c.hasAudio(),video:c.hasVideo(),screen:c.hasScreen(),minVideoBW:d.minVideoBW,attributes:c.getAttributes(),createOffer:d.createOffer,metadata:d.metadata,scheme:d.scheme},void 0,function(i,j){null===i?(L.Logger.error("Error when publishing the stream: ",j),h&&h(void 0,j)):(L.Logger.info("Stream assigned an Id, starting the publish process"),c.getID=function(){return i},c.hasData()&&(c.sendData=function(a){f(c,a)}),c.setAttributes=function(a){g(c,a)},b.localStreams[i]=c,c.room=b,c.pc=Erizo.Connection({callback:function(a){L.Logger.debug("Sending message",a),e("signaling_message",{streamId:c.getID(),msg:a},void 0,function(){})},iceServers:b.iceServers,maxAudioBW:d.maxAudioBW,maxVideoBW:d.maxVideoBW,limitMaxAudioBW:a.maxAudioBW,limitMaxVideoBW:a.maxVideoBW,audio:c.hasAudio(),video:c.hasVideo()}),c.pc.addStream(c.stream),c.pc.oniceconnectionstatechange=function(a){"failed"===a&&0!==b.state&&c&&!c.failed&&(c.failed=!0,L.Logger.warning("Publishing Stream",c.getID(),"has failed after successful ICE checks"),a=Erizo.StreamEvent({type:"stream-failed",msg:"Publishing stream failed after connection",stream:c}),b.dispatchEvent(a),b.unpublish(c))},d.createOffer||c.pc.createOffer(),h&&h(i))}));else c.hasData()&&e("publish",{state:"data",data:c.hasData(),audio:!1,video:!1,screen:!1,metadata:d.metadata,attributes:c.getAttributes()},void 0,function(a,d){null===a?(L.Logger.error("Error publishing stream ",d),h&&h(void 0,d)):(L.Logger.info("Stream published"),c.getID=function(){return a},c.sendData=function(a){f(c,a)},c.setAttributes=function(a){g(c,a)},b.localStreams[a]=c,c.room=b,h&&h(a))});else L.Logger.error("Trying to publish invalid stream"),h&&h(void 0,"Invalid Stream")},b.startRecording=function(a,b){a?(L.Logger.debug("Start Recording stream: "+a.getID()),d("startRecorder",{to:a.getID()},function(a,c){null===a?(L.Logger.error("Error on start recording",c),b&&b(void 0,c)):(L.Logger.info("Start recording",a),b&&b(a))})):(L.Logger.error("Trying to start recording on an invalid stream",a),b&&b(void 0,"Invalid Stream"))},b.stopRecording=function(a,b){d("stopRecorder",{id:a},function(c,d){null===c?(L.Logger.error("Error on stop recording",d),b&&b(void 0,d)):(L.Logger.info("Stop recording",a),b&&b(!0))})},b.unpublish=function(a,c){if(a&&a.local){d("unpublish",a.getID(),function(a,b){null===a?(L.Logger.error("Error unpublishing stream",b),c&&c(void 0,b)):(L.Logger.info("Stream unpublished"),c&&c(!0))});var e=a.room&&a.room.p2p;if(a.room=void 0,(a.hasAudio()||a.hasVideo()||a.hasScreen())&&void 0===a.url)if(e)for(var f in a.pc)a.pc[f].close(),a.pc[f]=void 0;else a.pc&&a.pc.close(),a.pc=void 0;delete b.localStreams[a.getID()],a.getID=function(){},a.sendData=function(){},a.setAttributes=function(){}}else L.Logger.error(),c&&c(void 0,"Cannot unpublish, stream does not exist or is not local")},b.subscribe=function(a,c,d){if(c=c||{},a&&!a.local){if(a.hasVideo()||a.hasAudio()||a.hasScreen())b.p2p?(e("subscribe",{streamId:a.getID(),metadata:c.metadata}),d&&d(!0)):(L.Logger.info("Checking subscribe options for",a.getID()),a.checkOptions(c),e("subscribe",{streamId:a.getID(),audio:c.audio,video:c.video,data:c.data,browser:Erizo.getBrowser(),createOffer:c.createOffer,metadata:c.metadata,slideShowMode:c.slideShowMode},void 0,function(f,g){null===f?(L.Logger.error("Error subscribing to stream ",g),d&&d(void 0,g)):(L.Logger.info("Subscriber added"),a.pc=Erizo.Connection({callback:function(b){L.Logger.info("Sending message",b),e("signaling_message",{streamId:a.getID(),msg:b,browser:a.pc.browser},void 0,function(){})},nop2p:!0,audio:c.audio,video:c.video,iceServers:b.iceServers}),a.pc.onaddstream=function(c){L.Logger.info("Stream subscribed"),a.stream=c.stream,c=Erizo.StreamEvent({type:"stream-subscribed",stream:a}),b.dispatchEvent(c)},a.pc.oniceconnectionstatechange=function(c){"failed"===c&&0!==b.state&&a&&!a.failed&&(a.failed=!0,L.Logger.warning("Subscribing stream",a.getID(),"has failed after successful ICE checks"),c=Erizo.StreamEvent({type:"stream-failed",msg:"Subscribing stream failed after connection",stream:a}),b.dispatchEvent(c),b.unsubscribe(a))},a.pc.createOffer(!0),d&&d(!0))}));else{if(!a.hasData()||!1===c.data)return L.Logger.warning("There's nothing to subscribe to"),void(d&&d(void 0,"Nothing to subscribe to"));e("subscribe",{streamId:a.getID(),data:c.data,metadata:c.metadata},void 0,function(c,e){if(null===c)L.Logger.error("Error subscribing to stream ",e),d&&d(void 0,e);else{L.Logger.info("Stream subscribed");var f=Erizo.StreamEvent({type:"stream-subscribed",stream:a});b.dispatchEvent(f),d&&d(!0)}})}L.Logger.info("Subscribing to: "+a.getID())}else{var f="Error on subscribe";a?a.local&&(L.Logger.warning("Cannot subscribe to local stream, you should subscribe to the remote version of your local stream"),f="Local copy of stream"):(L.Logger.warning("Cannot subscribe to invalid stream",a),f="Invalid or undefined stream"),d&&d(void 0,f)}},b.unsubscribe=function(a,c){void 0!==b.socket&&a&&!a.local&&d("unsubscribe",a.getID(),function(b,d){null===b?c&&c(void 0,d):(h(a),c&&c(!0))},function(){L.Logger.error("Error calling unsubscribe.")})},b.getStreamsByAttribute=function(a,c){var e,f,d=[];for(e in b.remoteStreams)b.remoteStreams.hasOwnProperty(e)&&(f=b.remoteStreams[e],void 0!==f.getAttributes()&&void 0!==f.getAttributes()[a]&&f.getAttributes()[a]===c&&d.push(f));return d},b};var L=L||{};L.Logger=function(a){return{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,enableLogPanel:function(){a.Logger.panel=document.createElement("textarea"),a.Logger.panel.setAttribute("id","licode-logs"),a.Logger.panel.setAttribute("style","width: 100%; height: 100%; display: none"),a.Logger.panel.setAttribute("rows",20),a.Logger.panel.setAttribute("cols",20),a.Logger.panel.setAttribute("readOnly",!0),document.body.appendChild(a.Logger.panel)},setLogLevel:function(b){b>a.Logger.NONE?b=a.Logger.NONE:b<a.Logger.DEBUG&&(b=a.Logger.DEBUG),a.Logger.logLevel=b},log:function(b){var c="";if(!(b<a.Logger.logLevel)){b===a.Logger.DEBUG?c+="DEBUG":b===a.Logger.TRACE?c+="TRACE":b===a.Logger.INFO?c+="INFO":b===a.Logger.WARNING?c+="WARNING":b===a.Logger.ERROR&&(c+="ERROR");for(var c=c+": ",d=[],e=0;e<arguments.length;e++)d[e]=arguments[e];if(d=d.slice(1),d=[c].concat(d),void 0!==a.Logger.panel){for(c="",e=0;e<d.length;e++)c+=d[e];a.Logger.panel.value=a.Logger.panel.value+"\n"+c}else console.log.apply(console,d)}},debug:function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];a.Logger.log.apply(a.Logger,[a.Logger.DEBUG].concat(b))},trace:function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];a.Logger.log.apply(a.Logger,[a.Logger.TRACE].concat(b))},info:function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];a.Logger.log.apply(a.Logger,[a.Logger.INFO].concat(b))},warning:function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];a.Logger.log.apply(a.Logger,[a.Logger.WARNING].concat(b))},error:function(){for(var b=[],c=0;c<arguments.length;c++)b[c]=arguments[c];a.Logger.log.apply(a.Logger,[a.Logger.ERROR].concat(b))}}}(L),L=L||{},L.Base64=function(){var a,b,c,d,e,f,g,h,i;for(a="A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,0,1,2,3,4,5,6,7,8,9,+,/".split(","),b=[],e=0;e<a.length;e+=1)b[a[e]]=e;return f=function(a){c=a,d=0},g=function(){var a;return!c||d>=c.length?-1:(a=255&c.charCodeAt(d),d+=1,a)},h=function(){if(!c)return-1;for(;;){if(d>=c.length)return-1;var a=c.charAt(d);if(d+=1,b[a])return b[a];if("A"===a)return 0}},i=function(a){return a=a.toString(16),1===a.length&&(a="0"+a),unescape("%"+a)},{encodeBase64:function(b){var c,d,e;for(f(b),b="",c=Array(3),d=0,e=!1;!e&&-1!==(c[0]=g());)c[1]=g(),c[2]=g(),b+=a[c[0]>>2],-1!==c[1]?(b+=a[c[0]<<4&48|c[1]>>4],-1!==c[2]?(b+=a[c[1]<<2&60|c[2]>>6],b+=a[63&c[2]]):(b+=a[c[1]<<2&60],b+="=",e=!0)):(b+=a[c[0]<<4&48],b+="=",b+="=",e=!0),d+=4,76<=d&&(b+="\n",d=0);return b},decodeBase64:function(a){var b,c;for(f(a),a="",b=Array(4),c=!1;!c&&-1!==(b[0]=h())&&-1!==(b[1]=h());)b[2]=h(),b[3]=h(),a+=i(b[0]<<2&255|b[1]>>4),-1!==b[2]?(a+=i(b[1]<<4&255|b[2]>>2),-1!==b[3]?a+=i(b[2]<<6&255|b[3]):c=!0):c=!0;return a}}}(L),function(){function a(){(new c.ElementQueries).init()}function b(a,b){var c=Object.prototype.toString.call(a),d=0,e=a.length;if("[object Array]"===c||"[object NodeList]"===c||"[object HTMLCollection]"===c||"undefined"!=typeof jQuery&&a instanceof jQuery||"undefined"!=typeof Elements&&a instanceof Elements)for(;d<e;d++)b(a[d]);else b(a)}var c=this.L=this.L||{};c.ElementQueries=function(){function a(a){return a||(a=document.documentElement),a=getComputedStyle(a,"fontSize"),parseFloat(a)||16}function b(b,c){var d=c.replace(/[0-9]*/,""),c=parseFloat(c);switch(d){case"px":return c;case"em":return c*a(b);case"rem":return c*a();case"vw":return c*document.documentElement.clientWidth/100;case"vh":return c*document.documentElement.clientHeight/100;case"vmin":case"vmax":return c*(0,Math["vmin"===d?"min":"max"])(document.documentElement.clientWidth/100,document.documentElement.clientHeight/100);default:return c}}function d(a){this.element=a,this.options=[];var c,d,e,h,i,j,k,l,f=0,g=0;this.addOption=function(a){this.options.push(a)};var m=["min-width","min-height","max-width","max-height"];this.call=function(){for(f=this.element.offsetWidth,g=this.element.offsetHeight,j={},c=0,d=this.options.length;c<d;c++)e=this.options[c],h=b(this.element,e.value),i="width"===e.property?f:g,l=e.mode+"-"+e.property,k="","min"===e.mode&&i>=h&&(k+=e.value),"max"===e.mode&&i<=h&&(k+=e.value),j[l]||(j[l]=""),k&&-1===(" "+j[l]+" ").indexOf(" "+k+" ")&&(j[l]+=" "+k);for(var a in m)j[m[a]]?this.element.setAttribute(m[a],j[m[a]].substr(1)):this.element.removeAttribute(m[a])}}function e(a,b){a.elementQueriesSetupInformation?a.elementQueriesSetupInformation.addOption(b):(a.elementQueriesSetupInformation=new d(a),a.elementQueriesSetupInformation.addOption(b),new c.ResizeSensor(a,function(){a.elementQueriesSetupInformation.call()})),a.elementQueriesSetupInformation.call()}function f(a){for(var b,a=a.replace(/'/g,'"');null!==(b=h.exec(a));)if(5<b.length){var c=b[1]||b[5],d=b[2],f=b[3];b=b[4];var g=void 0;if(document.querySelectorAll&&(g=document.querySelectorAll.bind(document)),!g&&"undefined"!=typeof $$&&(g=$$),!g&&"undefined"!=typeof jQuery&&(g=jQuery),!g)throw"No document.querySelectorAll, jQuery or Mootools's $$ found.";for(var c=g(c),g=0,i=c.length;g<i;g++)e(c[g],{mode:d,property:f,value:b})}}function g(a){var b="";if(a)if("string"==typeof a)a=a.toLowerCase(),(-1!==a.indexOf("min-width")||-1!==a.indexOf("max-width"))&&f(a);else for(var c=0,d=a.length;c<d;c++)1===a[c].type?(b=a[c].selectorText||a[c].cssText,-1!==b.indexOf("min-height")||-1!==b.indexOf("max-height")?f(b):(-1!==b.indexOf("min-width")||-1!==b.indexOf("max-width"))&&f(b)):4===a[c].type&&g(a[c].cssRules||a[c].rules)}var h=/,?([^,\n]*)\[[\s\t]*(min|max)-(width|height)[\s\t]*[~$\^]?=[\s\t]*"([^"]*)"[\s\t]*]([^\n\s\{]*)/gim;this.init=function(){for(var a=0,b=document.styleSheets.length;a<b;a++)g(document.styleSheets[a].cssText||document.styleSheets[a].cssRules||document.styleSheets[a].rules)}},window.addEventListener?window.addEventListener("load",a,!1):window.attachEvent("onload",a);var d=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)};c.ResizeSensor=function(a,e){function f(){var a=[];this.add=function(b){a.push(b)};var b,c;this.call=function(){for(b=0,c=a.length;b<c;b++)a[b].call()},this.remove=function(d){var e=[];for(b=0,c=a.length;b<c;b++)a[b]!==d&&e.push(a[b]);a=e},this.length=function(){return a.length}}function g(a,b){if(a.resizedAttached){if(a.resizedAttached)return void a.resizedAttached.add(b)}else a.resizedAttached=new f,a.resizedAttached.add(b);a.resizeSensor=document.createElement("div"),a.resizeSensor.className="resize-sensor",a.resizeSensor.style.cssText="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;",a.resizeSensor.innerHTML='<div class="resize-sensor-expand" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"><div style="position: absolute; left: 0; top: 0; transition: 0s;"></div></div><div class="resize-sensor-shrink" style="position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;"><div style="position: absolute; left: 0; top: 0; transition: 0s; width: 200%; height: 200%"></div></div>',a.appendChild(a.resizeSensor),"static"===(a.currentStyle?a.currentStyle.position:window.getComputedStyle?window.getComputedStyle(a,null).getPropertyValue("position"):a.style.position)&&(a.style.position="relative");var c=a.resizeSensor.childNodes[0],e=c.childNodes[0],g=a.resizeSensor.childNodes[1],h=function(){e.style.width="100000px",e.style.height="100000px",c.scrollLeft=1e5,c.scrollTop=1e5,g.scrollLeft=1e5,g.scrollTop=1e5};h();var i=!1,j=function(){a.resizedAttached&&(i&&(a.resizedAttached.call(),i=!1),d(j))};d(j);var k,l,m,n,o=function(){(m=a.offsetWidth)===k&&(n=a.offsetHeight)===l||(i=!0,k=m,l=n),h()},p=function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c)};p(c,"scroll",o),p(g,"scroll",o)}b(a,function(a){g(a,e)}),this.detach=function(b){c.ResizeSensor.detach(a,b)}},c.ResizeSensor.detach=function(a,c){b(a,function(a){a.resizedAttached&&"function"==typeof c&&(a.resizedAttached.remove(c),a.resizedAttached.length())||a.resizeSensor&&(a.contains(a.resizeSensor)&&a.removeChild(a.resizeSensor),delete a.resizeSensor,delete a.resizedAttached)})}}(),Erizo=Erizo||{},Erizo.View=function(){var a=Erizo.EventDispatcher({});return a.url="",a},Erizo=Erizo||{},Erizo.VideoPlayer=function(a){var c,d,b=Erizo.View({});return b.id=a.id,b.stream=a.stream.stream,b.elementID=a.elementID,c=function(){b.bar.display()},d=function(){b.bar.hide()},b.destroy=function(){b.video.pause(),delete b.resizer,b.parentNode.removeChild(b.div)},b.resize=function(){var c=b.container.offsetWidth,d=b.container.offsetHeight;a.stream.screen||!1===a.options.crop?.5625*c<d?(b.video.style.width=c+"px",b.video.style.height=.5625*c+"px",b.video.style.top=-(.5625*c/2-d/2)+"px",b.video.style.left="0px"):(b.video.style.height=d+"px",b.video.style.width=16/9*d+"px",b.video.style.left=-(16/9*d/2-c/2)+"px",b.video.style.top="0px"):c===b.containerWidth&&d===b.containerHeight||(.75*c>d?(b.video.style.width=c+"px",b.video.style.height=.75*c+"px",b.video.style.top=-(.75*c/2-d/2)+"px",b.video.style.left="0px"):(b.video.style.height=d+"px",b.video.style.width=4/3*d+"px",b.video.style.left=-(4/3*d/2-c/2)+"px",b.video.style.top="0px")),b.containerWidth=c,b.containerHeight=d},L.Logger.debug("Creating URL from stream "+b.stream),b.streamUrl=(window.URL||webkitURL).createObjectURL(b.stream),b.div=document.createElement("div"),b.div.setAttribute("id","player_"+b.id),b.div.setAttribute("class","player"),b.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),!1!==a.options.loader&&(b.loader=document.createElement("img"),b.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px"),b.loader.setAttribute("id","back_"+b.id),b.loader.setAttribute("class","loader"),b.loader.setAttribute("src",b.url+"/assets/loader.gif")),b.video=document.createElement("video"),b.video.setAttribute("id","stream"+b.id),b.video.setAttribute("class","stream"),b.video.setAttribute("style","width: 100%; height: 100%; position: absolute"),b.video.setAttribute("autoplay","autoplay"),a.stream.local&&(b.video.volume=0),b.container=void 0!==b.elementID?"object"==typeof b.elementID&&"function"==typeof b.elementID.appendChild?b.elementID:document.getElementById(b.elementID):document.body,b.container.appendChild(b.div),b.parentNode=b.div.parentNode,b.loader&&b.div.appendChild(b.loader),b.div.appendChild(b.video),b.containerWidth=0,b.containerHeight=0,!1!==a.options.resizer&&(b.resizer=new L.ResizeSensor(b.container,b.resize),b.resize()),!1!==a.options.bar?(b.bar=new Erizo.Bar({elementID:"player_"+b.id,id:b.id,stream:a.stream,media:b.video,options:a.options}),b.div.onmouseover=c,b.div.onmouseout=d):b.media=b.video,b.video.src=b.streamUrl,b},Erizo=Erizo||{},Erizo.AudioPlayer=function(a){var c,d,b=Erizo.View({});return b.id=a.id,b.stream=a.stream.stream,b.elementID=a.elementID,L.Logger.debug("Creating URL from stream "+b.stream),b.streamUrl=(window.URL||webkitURL).createObjectURL(b.stream),b.audio=document.createElement("audio"),b.audio.setAttribute("id","stream"+b.id),b.audio.setAttribute("class","stream"),b.audio.setAttribute("style","width: 100%; height: 100%; position: absolute"),b.audio.setAttribute("autoplay","autoplay"),a.stream.local&&(b.audio.volume=0),a.stream.local&&(b.audio.volume=0),void 0!==b.elementID?(b.destroy=function(){b.audio.pause(),b.parentNode.removeChild(b.div)},c=function(){b.bar.display()},d=function(){b.bar.hide()},b.div=document.createElement("div"),b.div.setAttribute("id","player_"+b.id),b.div.setAttribute("class","player"),b.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),b.container="object"==typeof b.elementID&&"function"==typeof b.elementID.appendChild?b.elementID:document.getElementById(b.elementID),b.container.appendChild(b.div),b.parentNode=b.div.parentNode,b.div.appendChild(b.audio),!1!==a.options.bar?(b.bar=new Erizo.Bar({elementID:"player_"+b.id,id:b.id,stream:a.stream,media:b.audio,options:a.options}),b.div.onmouseover=c,b.div.onmouseout=d):b.media=b.audio):(b.destroy=function(){
b.audio.pause(),b.parentNode.removeChild(b.audio)},document.body.appendChild(b.audio),b.parentNode=document.body),b.audio.src=b.streamUrl,b},Erizo=Erizo||{},Erizo.Bar=function(a){var c,d,b=Erizo.View({});return b.elementID=a.elementID,b.id=a.id,b.div=document.createElement("div"),b.div.setAttribute("id","bar_"+b.id),b.div.setAttribute("class","bar"),b.bar=document.createElement("div"),b.bar.setAttribute("style","width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)"),b.bar.setAttribute("id","subbar_"+b.id),b.bar.setAttribute("class","subbar"),b.link=document.createElement("a"),b.link.setAttribute("href","http://www.digivoice.net/"),b.link.setAttribute("class","link"),b.link.setAttribute("target","_blank"),b.logo=document.createElement("img"),b.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;"),b.logo.setAttribute("class","logo"),b.logo.setAttribute("alt","Digivoice.NET"),b.logo.setAttribute("src",b.url+"/assets/star.svg"),d=function(a){"block"!==a?a="none":clearTimeout(c),b.div.setAttribute("style","width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display:"+a)},b.display=function(){d("block")},b.hide=function(){c=setTimeout(d,1e3)},document.getElementById(b.elementID).appendChild(b.div),b.div.appendChild(b.bar),b.bar.appendChild(b.link),b.link.appendChild(b.logo),a.stream.screen||void 0!==a.options&&void 0!==a.options.speaker&&!0!==a.options.speaker||(b.speaker=new Erizo.Speaker({elementID:"subbar_"+b.id,id:b.id,stream:a.stream,media:a.media})),b.display(),b.hide(),b},Erizo=Erizo||{},Erizo.Speaker=function(a){var c,d,e,b=Erizo.View({}),f=50;return b.elementID=a.elementID,b.media=a.media,b.id=a.id,b.stream=a.stream,b.div=document.createElement("div"),b.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;"),b.icon=document.createElement("img"),b.icon.setAttribute("id","volume_"+b.id),b.icon.setAttribute("src",b.url+"/assets/sound48.png"),b.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;"),b.div.appendChild(b.icon),b.stream.local?(d=function(){b.media.muted=!0,b.icon.setAttribute("src",b.url+"/assets/mute48.png"),b.stream.stream.getAudioTracks()[0].enabled=!1},e=function(){b.media.muted=!1,b.icon.setAttribute("src",b.url+"/assets/sound48.png"),b.stream.stream.getAudioTracks()[0].enabled=!0},b.icon.onclick=function(){b.media.muted?e():d()}):(b.picker=document.createElement("input"),b.picker.setAttribute("id","picker_"+b.id),b.picker.type="range",b.picker.min=0,b.picker.max=100,b.picker.step=10,b.picker.value=f,b.picker.setAttribute("orient","vertical"),b.div.appendChild(b.picker),b.media.volume=b.picker.value/100,b.media.muted=!1,b.picker.oninput=function(){0<b.picker.value?(b.media.muted=!1,b.icon.setAttribute("src",b.url+"/assets/sound48.png")):(b.media.muted=!0,b.icon.setAttribute("src",b.url+"/assets/mute48.png")),b.media.volume=b.picker.value/100},c=function(a){b.picker.setAttribute("style","background: transparent; width: 32px; height: 100px; position: absolute; bottom: 90%; z-index: 1;"+b.div.offsetHeight+"px; right: 0px; -webkit-appearance: slider-vertical; display: "+a)},d=function(){b.icon.setAttribute("src",b.url+"/assets/mute48.png"),f=b.picker.value,b.picker.value=0,b.media.volume=0,b.media.muted=!0},e=function(){b.icon.setAttribute("src",b.url+"/assets/sound48.png"),b.picker.value=f,b.media.volume=b.picker.value/100,b.media.muted=!1},b.icon.onclick=function(){b.media.muted?e():d()},b.div.onmouseover=function(){c("block")},b.div.onmouseout=function(){c("none")},c("none")),document.getElementById(b.elementID).appendChild(b.div),b};